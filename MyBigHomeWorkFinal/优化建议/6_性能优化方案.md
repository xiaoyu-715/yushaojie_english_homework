# æ€§èƒ½ä¼˜åŒ–æ–¹æ¡ˆ

## 1. å†…å­˜ä¼˜åŒ–

### é—®é¢˜ 1ï¼šBitmap å†…å­˜æ³„æ¼

```java
// âŒ é”™è¯¯åšæ³•
ImageView imageView = findViewById(R.id.image);
Bitmap bitmap = BitmapFactory.decodeResource(getResources(), R.drawable.large_image);
imageView.setImageBitmap(bitmap);
```

**ä¼˜åŒ–æ–¹æ¡ˆï¼šä½¿ç”¨ Glide å›¾ç‰‡åŠ è½½åº“**

```kotlin
// app/build.gradle.kts
dependencies {
    implementation("com.github.bumptech.glide:glide:4.16.0")
    annotationProcessor("com.github.bumptech.glide:compiler:4.16.0")
}
```

```java
// âœ… æ­£ç¡®åšæ³•
Glide.with(this)
    .load(imageUrl)
    .placeholder(R.drawable.placeholder)
    .error(R.drawable.error)
    .centerCrop()
    .into(imageView);
```

### é—®é¢˜ 2ï¼šActivity/Context å†…å­˜æ³„æ¼

```java
// âŒ é”™è¯¯åšæ³• - é™æ€å˜é‡æŒæœ‰ Activity å¼•ç”¨
public class VocabularyActivity extends AppCompatActivity {
    private static VocabularyActivity instance;
    
    @Override
    protected void onCreate(Bundle savedInstanceState) {
        instance = this; // å†…å­˜æ³„æ¼ï¼
    }
}

// âŒ é”™è¯¯åšæ³• - Handler å†…å­˜æ³„æ¼
private Handler handler = new Handler() {
    @Override
    public void handleMessage(Message msg) {
        // æŒæœ‰å¤–éƒ¨ç±»å¼•ç”¨
    }
};
```

**ä¼˜åŒ–æ–¹æ¡ˆï¼šä½¿ç”¨å¼±å¼•ç”¨å’Œé™æ€å†…éƒ¨ç±»**

```java
// âœ… æ­£ç¡®åšæ³• - é™æ€å†…éƒ¨ç±» + å¼±å¼•ç”¨
private static class MyHandler extends Handler {
    private final WeakReference<VocabularyActivity> activityRef;
    
    MyHandler(VocabularyActivity activity) {
        this.activityRef = new WeakReference<>(activity);
    }
    
    @Override
    public void handleMessage(Message msg) {
        VocabularyActivity activity = activityRef.get();
        if (activity != null && !activity.isFinishing()) {
            // å¤„ç†æ¶ˆæ¯
        }
    }
}

private final MyHandler handler = new MyHandler(this);
```

### é—®é¢˜ 3ï¼šExecutorService æœªå…³é—­

```java
// âŒ å½“å‰ä»£ç 
private ExecutorService executorService;

@Override
protected void onCreate(Bundle savedInstanceState) {
    executorService = Executors.newSingleThreadExecutor();
}

@Override
protected void onDestroy() {
    super.onDestroy();
    if (executorService != null && !executorService.isShutdown()) {
        executorService.shutdown(); // åªè°ƒç”¨ shutdown å¯èƒ½ä¸å¤Ÿ
    }
}
```

**ä¼˜åŒ–æ–¹æ¡ˆï¼šæ­£ç¡®å…³é—­çº¿ç¨‹æ± **

```java
// âœ… æ­£ç¡®åšæ³•
@Override
protected void onDestroy() {
    super.onDestroy();
    if (executorService != null) {
        executorService.shutdown(); // ä¸å†æ¥å—æ–°ä»»åŠ¡
        try {
            // ç­‰å¾…ç°æœ‰ä»»åŠ¡å®Œæˆ
            if (!executorService.awaitTermination(2, TimeUnit.SECONDS)) {
                // å¼ºåˆ¶å…³é—­
                executorService.shutdownNow();
                // å†æ¬¡ç­‰å¾…
                if (!executorService.awaitTermination(2, TimeUnit.SECONDS)) {
                    Log.e(TAG, "çº¿ç¨‹æ± æœªèƒ½æ­£å¸¸å…³é—­");
                }
            }
        } catch (InterruptedException e) {
            executorService.shutdownNow();
            Thread.currentThread().interrupt();
        }
    }
}
```

## 2. æ•°æ®åº“ä¼˜åŒ–

### ä¼˜åŒ– 1ï¼šæ‰¹é‡æ’å…¥

```java
// âŒ ä½æ•ˆåšæ³• - é€æ¡æ’å…¥
for (VocabularyRecordEntity entity : vocabularyList) {
    vocabularyDao.insert(entity); // æ¯æ¬¡éƒ½æ˜¯ä¸€ä¸ªäº‹åŠ¡
}
```

```java
// âœ… é«˜æ•ˆåšæ³• - æ‰¹é‡æ’å…¥
@Dao
public interface VocabularyDao {
    @Insert
    void insertAll(List<VocabularyRecordEntity> vocabularies);
}

// ä½¿ç”¨äº‹åŠ¡
@Transaction
public void insertVocabulariesInTransaction(List<VocabularyRecordEntity> vocabularies) {
    vocabularyDao.insertAll(vocabularies);
}
```

### ä¼˜åŒ– 2ï¼šç´¢å¼•ä¼˜åŒ–

```java
// âŒ æœªæ·»åŠ ç´¢å¼•
@Entity(tableName = "vocabulary_records")
public class VocabularyRecordEntity {
    @PrimaryKey(autoGenerate = true)
    private int id;
    
    private String word; // é¢‘ç¹æŸ¥è¯¢ä½†æ— ç´¢å¼•
    private long lastStudyTime; // é¢‘ç¹æ’åºä½†æ— ç´¢å¼•
}
```

```java
// âœ… æ·»åŠ ç´¢å¼•
@Entity(
    tableName = "vocabulary_records",
    indices = {
        @Index(value = "word", unique = true),
        @Index("lastStudyTime"),
        @Index("isMastered")
    }
)
public class VocabularyRecordEntity {
    @PrimaryKey(autoGenerate = true)
    private int id;
    
    private String word;
    private long lastStudyTime;
    private boolean isMastered;
}
```

### ä¼˜åŒ– 3ï¼šåˆ†é¡µåŠ è½½

```java
// âŒ ä¸€æ¬¡æ€§åŠ è½½æ‰€æœ‰æ•°æ®
@Query("SELECT * FROM vocabulary_records")
List<VocabularyRecordEntity> getAllVocabulary();
```

```java
// âœ… ä½¿ç”¨ Paging 3
@Query("SELECT * FROM vocabulary_records ORDER BY lastStudyTime DESC")
PagingSource<Integer, VocabularyRecordEntity> getAllVocabularyPaged();

// åœ¨ Repository ä¸­
public Flow<PagingData<VocabularyRecordEntity>> getVocabularyPaged() {
    return new Pager<>(
        new PagingConfig(
            pageSize = 20,
            enablePlaceholders = false
        ),
        () -> vocabularyDao.getAllVocabularyPaged()
    ).getFlow();
}
```

## 3. UI æ¸²æŸ“ä¼˜åŒ–

### ä¼˜åŒ– 1ï¼šRecyclerView ä¼˜åŒ–

```java
// âœ… RecyclerView æœ€ä½³å®è·µ
recyclerView.setHasFixedSize(true); // å›ºå®šå¤§å°
recyclerView.setItemViewCacheSize(20); // å¢åŠ ç¼“å­˜
recyclerView.setDrawingCacheEnabled(true);
recyclerView.setDrawingCacheQuality(View.DRAWING_CACHE_QUALITY_HIGH);

// ä½¿ç”¨ DiffUtil ä¼˜åŒ–åˆ·æ–°
public class VocabularyDiffCallback extends DiffUtil.Callback {
    private List<VocabularyRecordEntity> oldList;
    private List<VocabularyRecordEntity> newList;
    
    @Override
    public boolean areItemsTheSame(int oldItemPosition, int newItemPosition) {
        return oldList.get(oldItemPosition).getId() == 
               newList.get(newItemPosition).getId();
    }
    
    @Override
    public boolean areContentsTheSame(int oldItemPosition, int newItemPosition) {
        return oldList.get(oldItemPosition).equals(newList.get(newItemPosition));
    }
}

// åœ¨ Adapter ä¸­ä½¿ç”¨
public void updateData(List<VocabularyRecordEntity> newList) {
    DiffUtil.DiffResult diffResult = DiffUtil.calculateDiff(
        new VocabularyDiffCallback(this.data, newList)
    );
    this.data = newList;
    diffResult.dispatchUpdatesTo(this);
}
```

### ä¼˜åŒ– 2ï¼šå¸ƒå±€ä¼˜åŒ–

```xml
<!-- âŒ è¿‡åº¦åµŒå¥— -->
<LinearLayout>
    <RelativeLayout>
        <LinearLayout>
            <TextView />
        </LinearLayout>
    </RelativeLayout>
</LinearLayout>

<!-- âœ… ä½¿ç”¨ ConstraintLayout å‡å°‘å±‚çº§ -->
<androidx.constraintlayout.widget.ConstraintLayout
    android:layout_width="match_parent"
    android:layout_height="wrap_content">
    
    <TextView
        android:id="@+id/tv_title"
        android:layout_width="0dp"
        android:layout_height="wrap_content"
        app:layout_constraintStart_toStartOf="parent"
        app:layout_constraintEnd_toEndOf="parent"
        app:layout_constraintTop_toTopOf="parent" />
    
</androidx.constraintlayout.widget.ConstraintLayout>
```

### ä¼˜åŒ– 3ï¼šé¿å…è¿‡åº¦ç»˜åˆ¶

```xml
<!-- âœ… ç§»é™¤ä¸å¿…è¦çš„èƒŒæ™¯ -->
<LinearLayout
    android:layout_width="match_parent"
    android:layout_height="match_parent"
    android:background="@android:color/transparent"> <!-- ä¸éœ€è¦èƒŒæ™¯å°±è®¾ä¸ºé€æ˜ -->
    
    <!-- å­è§†å›¾ -->
</LinearLayout>
```

## 4. å¯åŠ¨ä¼˜åŒ–

### ä¼˜åŒ– 1ï¼šæ‡’åŠ è½½å’Œå»¶è¿Ÿåˆå§‹åŒ–

```java
// âŒ Application onCreate ä¸­åŒæ­¥åˆå§‹åŒ–
public class MyApplication extends Application {
    @Override
    public void onCreate() {
        super.onCreate();
        
        // é˜»å¡ä¸»çº¿ç¨‹
        initDatabase();
        initNetwork();
        initAnalytics();
    }
}
```

```java
// âœ… å¼‚æ­¥åˆå§‹åŒ–éå…³é”®ç»„ä»¶
public class MyApplication extends Application {
    @Override
    public void onCreate() {
        super.onCreate();
        
        // å…³é”®ç»„ä»¶åŒæ­¥åˆå§‹åŒ–
        initCrashReport();
        
        // éå…³é”®ç»„ä»¶å¼‚æ­¥åˆå§‹åŒ–
        new Thread(() -> {
            initAnalytics();
            initNetwork();
        }).start();
    }
}
```

### ä¼˜åŒ– 2ï¼šé¿å…ä¸» Activity å¯åŠ¨æ…¢

```java
// âœ… ä½¿ç”¨å¯åŠ¨é¡µä¼˜åŒ–ä½“éªŒ
<activity
    android:name=".SplashActivity"
    android:theme="@style/SplashTheme"> <!-- ä½¿ç”¨è‡ªå®šä¹‰ä¸»é¢˜æ˜¾ç¤ºå¯åŠ¨å›¾ -->
</activity>

<!-- themes.xml -->
<style name="SplashTheme" parent="Theme.AppCompat.NoActionBar">
    <item name="android:windowBackground">@drawable/splash_background</item>
    <item name="android:windowNoTitle">true</item>
    <item name="android:windowFullscreen">true</item>
</style>
```

## 5. ä»£ç å±‚é¢ä¼˜åŒ–

### ä¼˜åŒ– 1ï¼šé¿å…é¢‘ç¹åˆ›å»ºå¯¹è±¡

```java
// âŒ åœ¨å¾ªç¯ä¸­åˆ›å»ºå¯¹è±¡
for (int i = 0; i < 1000; i++) {
    String text = "Progress: " + i + "/" + total; // æ¯æ¬¡åˆ›å»ºæ–°String
    updateProgress(text);
}
```

```java
// âœ… ä½¿ç”¨ StringBuilder
StringBuilder sb = new StringBuilder();
for (int i = 0; i < 1000; i++) {
    sb.setLength(0); // æ¸…ç©ºå†…å®¹
    sb.append("Progress: ").append(i).append("/").append(total);
    updateProgress(sb.toString());
}
```

### ä¼˜åŒ– 2ï¼šä½¿ç”¨ SparseArray ä»£æ›¿ HashMap

```java
// âŒ ä½¿ç”¨ HashMap<Integer, Object>
HashMap<Integer, String> map = new HashMap<>();
map.put(1, "value1");
```

```java
// âœ… ä½¿ç”¨ SparseArrayï¼ˆAndroid ä¼˜åŒ–ç‰ˆï¼‰
SparseArray<String> array = new SparseArray<>();
array.put(1, "value1");
// æ€§èƒ½æå‡ï¼Œå†…å­˜å ç”¨æ›´å°‘
```

### ä¼˜åŒ– 3ï¼šç¼“å­˜å¸¸ç”¨æ•°æ®

```java
public class VocabularyCache {
    private static VocabularyCache instance;
    private LruCache<String, VocabularyRecordEntity> cache;
    
    private VocabularyCache() {
        // ä½¿ç”¨æœ€å¤§å†…å­˜çš„ 1/8 ä½œä¸ºç¼“å­˜
        int maxMemory = (int) (Runtime.getRuntime().maxMemory() / 1024);
        int cacheSize = maxMemory / 8;
        
        cache = new LruCache<String, VocabularyRecordEntity>(cacheSize) {
            @Override
            protected int sizeOf(String key, VocabularyRecordEntity value) {
                return 1; // æ¯ä¸ªæ¡ç›®å¤§å°
            }
        };
    }
    
    public VocabularyRecordEntity get(String word) {
        return cache.get(word);
    }
    
    public void put(String word, VocabularyRecordEntity entity) {
        cache.put(word, entity);
    }
}
```

## 6. ç›‘æ§å’Œåˆ†æå·¥å…·

### ä½¿ç”¨ LeakCanary æ£€æµ‹å†…å­˜æ³„æ¼

```kotlin
// app/build.gradle.kts
dependencies {
    debugImplementation("com.squareup.leakcanary:leakcanary-android:2.12")
}
```

### ä½¿ç”¨ Profiler åˆ†ææ€§èƒ½

1. Android Studio â†’ View â†’ Tool Windows â†’ Profiler
2. é€‰æ‹©è¦åˆ†æçš„è¿›ç¨‹
3. æŸ¥çœ‹ CPUã€å†…å­˜ã€ç½‘ç»œä½¿ç”¨æƒ…å†µ

### ä½¿ç”¨ Systrace åˆ†æå¡é¡¿

```bash
# å‘½ä»¤è¡Œå·¥å…·
python systrace.py --time=10 -o myapp.html sched gfx view
```

## æ€§èƒ½ä¼˜åŒ–æ£€æŸ¥æ¸…å•

### å†…å­˜ä¼˜åŒ–
- [ ] ä¿®å¤æ‰€æœ‰å†…å­˜æ³„æ¼
- [ ] ä½¿ç”¨å›¾ç‰‡åŠ è½½åº“ï¼ˆGlide/Coilï¼‰
- [ ] æ­£ç¡®ç®¡ç† Bitmap
- [ ] é¿å…é™æ€å¼•ç”¨ Activity/Context

### æ•°æ®åº“ä¼˜åŒ–
- [ ] æ·»åŠ å¿…è¦çš„ç´¢å¼•
- [ ] ä½¿ç”¨æ‰¹é‡æ“ä½œ
- [ ] å®ç°åˆ†é¡µåŠ è½½
- [ ] å¼‚æ­¥æ“ä½œæ•°æ®åº“

### UI ä¼˜åŒ–
- [ ] å‡å°‘å¸ƒå±€å±‚çº§
- [ ] ä½¿ç”¨ ConstraintLayout
- [ ] é¿å…è¿‡åº¦ç»˜åˆ¶
- [ ] RecyclerView ä½¿ç”¨ DiffUtil

### å¯åŠ¨ä¼˜åŒ–
- [ ] å¼‚æ­¥åˆå§‹åŒ–éå…³é”®ç»„ä»¶
- [ ] ä¼˜åŒ– Application onCreate
- [ ] ä½¿ç”¨å¯åŠ¨é¡µä¼˜åŒ–ä½“éªŒ

### ä»£ç ä¼˜åŒ–
- [ ] é¿å…åœ¨å¾ªç¯ä¸­åˆ›å»ºå¯¹è±¡
- [ ] ä½¿ç”¨åˆé€‚çš„æ•°æ®ç»“æ„
- [ ] å®ç°ç¼“å­˜æœºåˆ¶

## é¢„æœŸæ•ˆæœ

- âš¡ å¯åŠ¨æ—¶é—´å‡å°‘ 50%+
- ğŸ“‰ å†…å­˜å ç”¨é™ä½ 30%+
- ğŸš€ UI æµç•…åº¦æå‡åˆ° 60fps
- ğŸ”‹ ç”µæ± ç»­èˆªæå‡
- ğŸ“± æ”¯æŒæ›´ä½é…ç½®è®¾å¤‡


