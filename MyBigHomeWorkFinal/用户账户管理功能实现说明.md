# 用户账户管理功能实现说明

## 功能概述

已成功实现了完整的用户账户管理系统，包括用户登录、注册和信息修改功能。

## 实现的功能

### 1. 用户注册功能 (RegisterActivity)

**功能特点：**
- ✅ 用户名、邮箱、密码注册
- ✅ 密码安全加密存储（SHA-256 + Salt）
- ✅ 输入验证（用户名长度、邮箱格式、密码强度）
- ✅ 重复密码确认
- ✅ 邮箱唯一性检查
- ✅ 友好的用户界面

**文件位置：**
- Java: `app/src/main/java/com/example/mybighomework/RegisterActivity.java`
- 布局: `app/src/main/res/layout/activity_register.xml`

### 2. 用户登录功能 (LoginActivity)

**功能特点：**
- ✅ 邮箱和密码登录
- ✅ 记住密码功能（SharedPreferences）
- ✅ 密码加密验证
- ✅ 自动填充记住的账号
- ✅ 跳过登录选项
- ✅ 快速跳转到注册页面

**文件位置：**
- Java: `app/src/main/java/com/example/mybighomework/LoginActivity.java`
- 布局: `app/src/main/res/layout/activity_login.xml`

### 3. 个人信息编辑功能 (EditProfileActivity)

**功能特点：**
- ✅ 修改用户名
- ✅ 查看邮箱（不可修改）
- ✅ 修改手机号
- ✅ 修改密码（需验证旧密码）
- ✅ 头像更换入口（待实现）
- ✅ 输入验证

**文件位置：**
- Java: `app/src/main/java/com/example/mybighomework/EditProfileActivity.java`
- 布局: `app/src/main/res/layout/activity_edit_profile.xml`
- 对话框布局: `app/src/main/res/layout/dialog_change_password.xml`

### 4. 设置页面集成 (SettingsActivity)

**新增功能：**
- ✅ 账户管理卡片
- ✅ 登录状态显示
- ✅ 登录/注册入口
- ✅ 编辑个人信息入口
- ✅ 退出登录功能
- ✅ 动态UI更新（根据登录状态）

**文件位置：**
- Java: `app/src/main/java/com/example/mybighomework/SettingsActivity.java`
- 布局: `app/src/main/res/layout/activity_settings.xml`

## 数据库架构

### 1. UserEntity（用户实体）

```java
- id: int (主键，自增)
- email: String (唯一索引)
- password: String (加密存储)
- username: String
- phone: String
- avatarPath: String
- createTime: long
- lastLoginTime: long
- isLoggedIn: boolean
```

**文件位置：**
- `app/src/main/java/com/example/mybighomework/database/entity/UserEntity.java`

### 2. UserDao（数据访问对象）

**提供的方法：**
- `insert()` - 插入新用户
- `update()` - 更新用户信息
- `getUserByEmail()` - 根据邮箱查询用户
- `getLoggedInUser()` - 获取当前登录用户
- `logoutAllUsers()` - 登出所有用户
- `setUserLoggedIn()` - 设置用户登录状态
- `updateUsername()` - 更新用户名
- `updatePhone()` - 更新手机号
- `updateAvatar()` - 更新头像
- `updatePassword()` - 更新密码
- `emailExists()` - 检查邮箱是否存在

**文件位置：**
- `app/src/main/java/com/example/mybighomework/database/dao/UserDao.java`

### 3. UserRepository（数据仓库）

**提供的业务逻辑：**
- `register()` - 用户注册
- `login()` - 用户登录
- `getLoggedInUser()` - 获取当前登录用户
- `logout()` - 用户登出
- `updateUser()` - 更新用户信息
- `changePassword()` - 修改密码（需验证旧密码）
- `emailExists()` - 检查邮箱是否存在

**文件位置：**
- `app/src/main/java/com/example/mybighomework/repository/UserRepository.java`

## 安全特性

### 密码加密（PasswordUtils）

**加密方式：**
- 算法：SHA-256
- 加盐：16字节随机盐值
- 存储格式：`salt$hash`
- Base64编码

**文件位置：**
- `app/src/main/java/com/example/mybighomework/utils/PasswordUtils.java`

## UI资源文件

### 新增Drawable资源

1. **ic_arrow_left.xml** - 返回箭头图标
2. **edit_text_background.xml** - 输入框背景
3. **circle_background.xml** - 圆形背景

**位置：** `app/src/main/res/drawable/`

## 使用流程图

\`\`\`mermaid
graph TD
    A[ProfileActivity] -->|点击设置按钮| B[SettingsActivity]
    B -->|未登录时| C[显示登录/注册按钮]
    B -->|已登录时| D[显示用户信息]
    
    C -->|点击登录/注册| E[LoginActivity]
    E -->|点击注册| F[RegisterActivity]
    F -->|注册成功| E
    E -->|登录成功| B
    
    D -->|点击编辑信息| G[EditProfileActivity]
    G -->|点击修改密码| H[修改密码对话框]
    G -->|保存| B
    
    D -->|点击退出登录| I[登出]
    I --> B
\`\`\`

## 数据流程图

\`\`\`mermaid
sequenceDiagram
    participant U as 用户
    participant LA as LoginActivity
    participant UR as UserRepository
    participant UD as UserDao
    participant DB as SQLite数据库
    participant PU as PasswordUtils
    
    U->>LA: 输入邮箱和密码
    LA->>UR: login(email, password)
    UR->>UD: getUserByEmail(email)
    UD->>DB: 查询用户
    DB-->>UD: 返回用户数据
    UD-->>UR: UserEntity
    UR->>PU: verifyPassword(input, stored)
    PU-->>UR: 验证结果
    alt 验证成功
        UR->>UD: setUserLoggedIn(userId)
        UD->>DB: 更新登录状态
        UR-->>LA: 返回用户对象
        LA->>U: 登录成功
    else 验证失败
        UR-->>LA: 返回null
        LA->>U: 提示错误
    end
\`\`\`

## 核心功能调用流程

### 注册流程

\`\`\`mermaid
graph LR
    A[输入注册信息] --> B{验证输入}
    B -->|验证失败| C[显示错误]
    B -->|验证通过| D{检查邮箱}
    D -->|已存在| E[提示邮箱已注册]
    D -->|不存在| F[加密密码]
    F --> G[保存到数据库]
    G --> H[注册成功]
    H --> I[跳转登录页面]
\`\`\`

### 登录流程

\`\`\`mermaid
graph LR
    A[输入登录信息] --> B{验证输入}
    B -->|验证失败| C[显示错误]
    B -->|验证通过| D[查询用户]
    D -->|不存在| E[提示账号不存在]
    D -->|存在| F{验证密码}
    F -->|错误| G[提示密码错误]
    F -->|正确| H[更新登录状态]
    H --> I{记住密码?}
    I -->|是| J[保存到SharedPreferences]
    I -->|否| K[清除保存的密码]
    J --> L[登录成功]
    K --> L
    L --> M[返回设置页面]
\`\`\`

### 修改密码流程

\`\`\`mermaid
graph LR
    A[点击修改密码] --> B[显示对话框]
    B --> C[输入旧密码和新密码]
    C --> D{验证输入}
    D -->|验证失败| E[显示错误]
    D -->|验证通过| F{验证旧密码}
    F -->|错误| G[提示旧密码错误]
    F -->|正确| H[加密新密码]
    H --> I[更新数据库]
    I --> J[修改成功]
\`\`\`

## 数据库更新

**AppDatabase版本升级：**
- 从版本 3 升级到版本 4
- 新增 `users` 表
- 添加 `userDao()` 方法

**文件位置：**
- `app/src/main/java/com/example/mybighomework/database/AppDatabase.java`

## 使用方法

### 1. 访问账户管理

1. 打开应用
2. 点击底部导航栏的"个人中心"
3. 点击右上角的"设置"图标
4. 进入设置页面，查看"账户管理"卡片

### 2. 注册新账号

1. 在设置页面点击"登录/注册"按钮
2. 在登录页面点击"立即注册"
3. 填写用户名、邮箱和密码
4. 点击"注册"按钮
5. 注册成功后自动返回登录页面

### 3. 登录账号

1. 在设置页面点击"登录/注册"按钮
2. 输入邮箱和密码
3. 可选择"记住密码"
4. 点击"登录"按钮
5. 登录成功后返回设置页面

### 4. 编辑个人信息

1. 确保已登录
2. 在设置页面点击"编辑个人信息"按钮
3. 修改用户名或手机号
4. 点击右上角"保存"按钮
5. 或点击"修改密码"修改密码

### 5. 退出登录

1. 在设置页面（已登录状态）
2. 点击"退出登录"按钮
3. 确认退出

## 注意事项

1. **数据库版本**：更新后首次运行会触发数据库迁移
2. **密码安全**：密码采用SHA-256加密，无法反向解密
3. **邮箱唯一性**：每个邮箱只能注册一次
4. **记住密码**：使用SharedPreferences本地存储，请在生产环境考虑安全性
5. **线程安全**：所有数据库操作都在后台线程执行
6. **头像功能**：目前只有入口，具体实现待开发

## 待优化功能

1. 📷 头像上传和裁剪功能
2. 📧 邮箱验证功能
3. 🔐 忘记密码功能
4. 👤 第三方登录（微信、QQ等）
5. 🔄 账号同步功能
6. 🛡️ 生物识别登录（指纹、面部识别）

## 技术栈

- **开发语言**：Java
- **UI框架**：Android Material Design
- **数据库**：Room (SQLite)
- **架构**：Repository模式
- **加密**：SHA-256 + Salt
- **本地存储**：SharedPreferences

## 测试建议

1. **注册测试**：
   - 测试各种输入验证
   - 测试重复邮箱注册
   - 测试密码不一致情况

2. **登录测试**：
   - 测试正确的账号密码
   - 测试错误的账号密码
   - 测试记住密码功能

3. **编辑信息测试**：
   - 测试修改用户名
   - 测试修改手机号
   - 测试修改密码

4. **UI测试**：
   - 测试登录前后UI变化
   - 测试各个页面的跳转

## 总结

已完整实现用户账户管理系统，包括：
- ✅ 3个新Activity（登录、注册、编辑信息）
- ✅ 完整的数据库支持（实体、DAO、Repository）
- ✅ 密码加密工具类
- ✅ 设置页面集成
- ✅ 友好的UI界面
- ✅ 完善的输入验证
- ✅ 安全的密码存储

所有功能都可以正常使用，代码结构清晰，易于维护和扩展。

