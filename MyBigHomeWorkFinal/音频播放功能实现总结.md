# éŸ³é¢‘æ’­æ”¾åŠŸèƒ½å®ç°æ€»ç»“

## ğŸ“‹ é¡¹ç›®æ¦‚è¿°

**å®æ–½æ—¥æœŸ**: 2025å¹´10æœˆ9æ—¥  
**åŠŸèƒ½æ¨¡å—**: æ¯æ—¥ä¸€å¥ - éŸ³é¢‘æ’­æ”¾åŠŸèƒ½  
**éŸ³é¢‘æ¥æº**: é‡‘å±±è¯éœ¸APIæä¾›çš„TTSéŸ³é¢‘

---

## âœ… å®Œæˆçš„åŠŸèƒ½

### 1. åˆ›å»ºéŸ³é¢‘æ’­æ”¾ç®¡ç†å™¨

**æ–‡ä»¶**: `app/src/main/java/com/example/mybighomework/utils/AudioPlayerManager.java`

æ ¸å¿ƒåŠŸèƒ½ï¼š
- âœ… æ’­æ”¾/æš‚åœ/åœæ­¢æ§åˆ¶
- âœ… æ’­æ”¾çŠ¶æ€ç®¡ç†
- âœ… è¿›åº¦æ›´æ–°å›è°ƒ
- âœ… é”™è¯¯å¤„ç†
- âœ… è‡ªåŠ¨èµ„æºé‡Šæ”¾

### 2. é›†æˆåˆ°æ¯æ—¥ä¸€å¥é¡µé¢

**æ–‡ä»¶**: `app/src/main/java/com/example/mybighomework/DailySentenceActivity.java`

æ–°å¢åŠŸèƒ½ï¼š
- âœ… ç‚¹å‡»æ’­æ”¾æŒ‰é’®æ’­æ”¾éŸ³é¢‘
- âœ… å®æ—¶æ›´æ–°æŒ‰é’®çŠ¶æ€
- âœ… æ’­æ”¾/æš‚åœ/åŠ è½½çŠ¶æ€æ˜¾ç¤º
- âœ… Toastæç¤ºä¿¡æ¯
- âœ… ç”Ÿå‘½å‘¨æœŸç®¡ç†

---

## ğŸ¯ åŠŸèƒ½ç‰¹æ€§

### 1. æ™ºèƒ½æ’­æ”¾æ§åˆ¶

```java
// ç‚¹å‡»æ’­æ”¾æŒ‰é’®ï¼š
- ç¬¬ä¸€æ¬¡ç‚¹å‡» â†’ å¼€å§‹æ’­æ”¾
- æ’­æ”¾ä¸­ç‚¹å‡» â†’ æš‚åœ
- æš‚åœæ—¶ç‚¹å‡» â†’ ç»§ç»­æ’­æ”¾
- åˆ‡æ¢å¥å­ â†’ è‡ªåŠ¨åœæ­¢å¹¶æ’­æ”¾æ–°éŸ³é¢‘
```

### 2. æŒ‰é’®çŠ¶æ€æ˜¾ç¤º

| çŠ¶æ€ | æŒ‰é’®æ–‡å­— | æŒ‰é’®çŠ¶æ€ |
|------|---------|---------|
| åˆå§‹ | â–¶ æ’­æ”¾ | å¯ç‚¹å‡» |
| åŠ è½½ä¸­ | åŠ è½½ä¸­... | ä¸å¯ç‚¹å‡» |
| æ’­æ”¾ä¸­ | â¸ æš‚åœ | å¯ç‚¹å‡» |
| æš‚åœ | â–¶ æ’­æ”¾ | å¯ç‚¹å‡» |
| å®Œæˆ | â–¶ æ’­æ”¾ | å¯ç‚¹å‡» |

### 3. é”™è¯¯å¤„ç†

```java
åœºæ™¯1: æ— éŸ³é¢‘URL
â†’ Toastæç¤ºï¼š"è¯¥å¥å­æš‚æ— éŸ³é¢‘"

åœºæ™¯2: ç½‘ç»œåŠ è½½å¤±è´¥
â†’ Toastæç¤ºï¼š"æ’­æ”¾å¤±è´¥ï¼Œè¯·æ£€æŸ¥ç½‘ç»œ"

åœºæ™¯3: éŸ³é¢‘æ ¼å¼é”™è¯¯
â†’ Toastæç¤ºï¼š"æ’­æ”¾å¼‚å¸¸"

åœºæ™¯4: æ’­æ”¾å®Œæˆ
â†’ Toastæç¤ºï¼š"æ’­æ”¾å®Œæˆ"
```

### 4. ç”Ÿå‘½å‘¨æœŸç®¡ç†

```java
onPause() â†’ è‡ªåŠ¨æš‚åœæ’­æ”¾
onDestroy() â†’ é‡Šæ”¾éŸ³é¢‘èµ„æº
```

---

## ğŸ”„ å·¥ä½œæµç¨‹

```mermaid
graph TB
    A[ç‚¹å‡»æ’­æ”¾æŒ‰é’®] --> B{æœ‰éŸ³é¢‘URL?}
    B -->|æ— | C[æç¤ºæ— éŸ³é¢‘]
    B -->|æœ‰| D{å½“å‰çŠ¶æ€}
    D -->|æœªæ’­æ”¾| E[å¼€å§‹æ’­æ”¾]
    D -->|æ’­æ”¾ä¸­| F[æš‚åœ]
    D -->|æš‚åœ| G[ç»§ç»­æ’­æ”¾]
    E --> H[æ›´æ–°æŒ‰é’®: åŠ è½½ä¸­]
    H --> I{å‡†å¤‡æˆåŠŸ?}
    I -->|æ˜¯| J[æ’­æ”¾éŸ³é¢‘]
    J --> K[æ›´æ–°æŒ‰é’®: æš‚åœ]
    I -->|å¦| L[æ˜¾ç¤ºé”™è¯¯]
    L --> M[æ¢å¤æŒ‰é’®]
    K --> N{æ’­æ”¾å®Œæˆ}
    N --> O[æç¤ºå®Œæˆ]
    O --> M
    
    style A fill:#e1f5fe
    style E fill:#c8e6c9
    style J fill:#fff9c4
    style L fill:#ffcdd2
```

---

## ğŸ’» æ ¸å¿ƒä»£ç 

### 1. AudioPlayerManager ç±»

```java
public class AudioPlayerManager {
    private MediaPlayer mediaPlayer;
    
    // æ’­æ”¾éŸ³é¢‘
    public void play(String url) {
        // æ™ºèƒ½åˆ¤æ–­ï¼šæ’­æ”¾/æš‚åœ/åˆ‡æ¢
        if (isPlaying() && url.equals(currentUrl)) {
            pause();  // æš‚åœå½“å‰
        } else if (mediaPlayer != null && url.equals(currentUrl)) {
            resume(); // ç»§ç»­æ’­æ”¾
        } else {
            // æ’­æ”¾æ–°éŸ³é¢‘
            prepareAndPlay(url);
        }
    }
    
    // çŠ¶æ€ç›‘å¬
    public interface PlaybackStateListener {
        void onPlaying();
        void onPaused();
        void onLoading();
        void onError(String error);
        void onCompletion();
        void onProgress(int current, int duration);
    }
}
```

### 2. DailySentenceActivity é›†æˆ

```java
// åˆå§‹åŒ–éŸ³é¢‘ç®¡ç†å™¨
audioPlayerManager = new AudioPlayerManager();

// è®¾ç½®çŠ¶æ€ç›‘å¬
audioPlayerManager.setPlaybackStateListener(new PlaybackStateListener() {
    @Override
    public void onPlaying() {
        btnPlayAudio.setText("â¸ æš‚åœ");
    }
    
    @Override
    public void onLoading() {
        btnPlayAudio.setText("åŠ è½½ä¸­...");
        btnPlayAudio.setEnabled(false);
    }
    
    @Override
    public void onError(String error) {
        Toast.makeText(this, error, Toast.LENGTH_SHORT).show();
    }
});

// æ’­æ”¾æŒ‰é’®ç‚¹å‡»
btnPlayAudio.setOnClickListener(v -> {
    String audioUrl = currentSentence.getAudioUrl();
    if (audioUrl != null) {
        audioPlayerManager.play(audioUrl);
    } else {
        Toast.makeText(this, "è¯¥å¥å­æš‚æ— éŸ³é¢‘", Toast.LENGTH_SHORT).show();
    }
});

// ç”Ÿå‘½å‘¨æœŸç®¡ç†
@Override
protected void onPause() {
    if (audioPlayerManager.isPlaying()) {
        audioPlayerManager.pause();
    }
}

@Override
protected void onDestroy() {
    audioPlayerManager.release();
}
```

---

## ğŸ¨ UIæ•ˆæœ

### æ’­æ”¾æŒ‰é’®çŠ¶æ€å˜åŒ–

```
åˆå§‹çŠ¶æ€:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  â–¶ æ’­æ”¾    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

ç‚¹å‡»å:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ åŠ è½½ä¸­...  â”‚  (ç°è‰²ï¼Œä¸å¯ç‚¹å‡»)
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

æ’­æ”¾ä¸­:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  â¸ æš‚åœ    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

æš‚åœå:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  â–¶ æ’­æ”¾    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ“Š æŠ€æœ¯å®ç°

### 1. MediaPlayer ä½¿ç”¨

```java
// åˆ›å»ºMediaPlayer
MediaPlayer mediaPlayer = new MediaPlayer();

// è®¾ç½®éŸ³é¢‘å±æ€§
AudioAttributes audioAttributes = new AudioAttributes.Builder()
    .setContentType(AudioAttributes.CONTENT_TYPE_MUSIC)
    .setUsage(AudioAttributes.USAGE_MEDIA)
    .build();
mediaPlayer.setAudioAttributes(audioAttributes);

// è®¾ç½®æ•°æ®æºï¼ˆæ”¯æŒç½‘ç»œURLï¼‰
mediaPlayer.setDataSource("http://news.iciba.com/admin/tts/xxx.mp3");

// å¼‚æ­¥å‡†å¤‡
mediaPlayer.prepareAsync();

// å‡†å¤‡å®Œæˆç›‘å¬
mediaPlayer.setOnPreparedListener(mp -> {
    mp.start(); // å¼€å§‹æ’­æ”¾
});

// æ’­æ”¾å®Œæˆç›‘å¬
mediaPlayer.setOnCompletionListener(mp -> {
    // æ’­æ”¾ç»“æŸå¤„ç†
});

// é”™è¯¯ç›‘å¬
mediaPlayer.setOnErrorListener((mp, what, extra) -> {
    // é”™è¯¯å¤„ç†
    return true;
});
```

### 2. è¿›åº¦æ›´æ–°

```java
private void startProgressUpdate() {
    new Thread(() -> {
        while (mediaPlayer.isPlaying()) {
            int current = mediaPlayer.getCurrentPosition();
            int duration = mediaPlayer.getDuration();
            notifyProgress(current, duration);
            Thread.sleep(500); // æ¯500msæ›´æ–°ä¸€æ¬¡
        }
    }).start();
}
```

### 3. èµ„æºé‡Šæ”¾

```java
public void release() {
    if (mediaPlayer != null) {
        if (mediaPlayer.isPlaying()) {
            mediaPlayer.stop();
        }
        mediaPlayer.reset();
        mediaPlayer.release();
        mediaPlayer = null;
    }
}
```

---

## ğŸ§ª æµ‹è¯•éªŒè¯

### æµ‹è¯•åœºæ™¯

#### åœºæ™¯1: æ­£å¸¸æ’­æ”¾

**æ­¥éª¤**:
1. æ‰“å¼€æ¯æ—¥ä¸€å¥é¡µé¢
2. ç‚¹å‡»"æ’­æ”¾"æŒ‰é’®
3. è§‚å¯ŸæŒ‰é’®çŠ¶æ€å˜åŒ–

**é¢„æœŸ**:
- æŒ‰é’®æ˜¾ç¤º"åŠ è½½ä¸­..."ï¼ˆç°è‰²ï¼‰
- 1-2ç§’åæ˜¾ç¤º"â¸ æš‚åœ"
- èƒ½å¬åˆ°è‹±æ–‡æœ—è¯»
- æ’­æ”¾å®Œæˆåæç¤º"æ’­æ”¾å®Œæˆ"

#### åœºæ™¯2: æš‚åœ/ç»§ç»­

**æ­¥éª¤**:
1. æ’­æ”¾ä¸­ç‚¹å‡»"æš‚åœ"æŒ‰é’®
2. å†æ¬¡ç‚¹å‡»"æ’­æ”¾"æŒ‰é’®

**é¢„æœŸ**:
- ç¬¬ä¸€æ¬¡ç‚¹å‡»ï¼šéŸ³é¢‘æš‚åœï¼ŒæŒ‰é’®å˜ä¸º"â–¶ æ’­æ”¾"
- ç¬¬äºŒæ¬¡ç‚¹å‡»ï¼šç»§ç»­æ’­æ”¾ï¼ŒæŒ‰é’®å˜ä¸º"â¸ æš‚åœ"

#### åœºæ™¯3: åˆ‡æ¢å¥å­

**æ­¥éª¤**:
1. æ’­æ”¾å½“å‰å¥å­
2. åˆ‡æ¢åˆ°å†å²è®°å½•ä¸­çš„å…¶ä»–å¥å­
3. ç‚¹å‡»æ’­æ”¾

**é¢„æœŸ**:
- åœæ­¢å½“å‰æ’­æ”¾
- å¼€å§‹æ’­æ”¾æ–°å¥å­

#### åœºæ™¯4: ç½‘ç»œå¼‚å¸¸

**æ­¥éª¤**:
1. æ–­å¼€ç½‘ç»œ
2. ç‚¹å‡»æ’­æ”¾æŒ‰é’®

**é¢„æœŸ**:
- Toastæç¤ºï¼š"æ’­æ”¾å¤±è´¥ï¼Œè¯·æ£€æŸ¥ç½‘ç»œ"
- æŒ‰é’®æ¢å¤ä¸º"â–¶ æ’­æ”¾"

#### åœºæ™¯5: ç”Ÿå‘½å‘¨æœŸ

**æ­¥éª¤**:
1. æ’­æ”¾éŸ³é¢‘
2. æŒ‰Homeé”®åˆ‡åˆ°åå°
3. å†æ¬¡æ‰“å¼€åº”ç”¨

**é¢„æœŸ**:
- åˆ‡åˆ°åå°æ—¶è‡ªåŠ¨æš‚åœ
- æ¢å¤åº”ç”¨æ—¶æŒ‰é’®æ˜¾ç¤º"â–¶ æ’­æ”¾"

---

## ğŸ“ éŸ³é¢‘URLç¤ºä¾‹

é‡‘å±±è¯éœ¸APIè¿”å›çš„éŸ³é¢‘URLæ ¼å¼ï¼š

```
http://news.iciba.com/admin/tts/2025-10-09-day.mp3
```

ç‰¹ç‚¹ï¼š
- HTTPåè®®ï¼ˆå·²é…ç½®æ˜æ–‡æµé‡ï¼‰
- MP3æ ¼å¼
- æ–‡ä»¶å¤§å°çº¦50-200KB
- æ—¶é•¿çº¦5-15ç§’

---

## âš ï¸ æ³¨æ„äº‹é¡¹

### 1. ç½‘ç»œæƒé™

å·²åœ¨`AndroidManifest.xml`ä¸­é…ç½®ï¼š
```xml
<uses-permission android:name="android.permission.INTERNET" />
```

### 2. æ˜æ–‡æµé‡

å·²é…ç½®HTTPæ”¯æŒï¼š
```xml
android:usesCleartextTraffic="true"
```

### 3. éŸ³é¢‘ç„¦ç‚¹

å½“å‰å®ç°æœªå¤„ç†éŸ³é¢‘ç„¦ç‚¹ï¼Œåç»­å¯ä¼˜åŒ–ï¼š
```java
// å¯é€‰ï¼šè¯·æ±‚éŸ³é¢‘ç„¦ç‚¹
AudioManager audioManager = (AudioManager) getSystemService(AUDIO_SERVICE);
int result = audioManager.requestAudioFocus(...);
```

### 4. åå°æ’­æ”¾

å½“å‰åˆ‡åˆ°åå°ä¼šè‡ªåŠ¨æš‚åœï¼Œå¦‚éœ€åå°æ’­æ”¾éœ€è¦ï¼š
- ä½¿ç”¨Foreground Service
- æ·»åŠ é€šçŸ¥æ æ§åˆ¶
- å¤„ç†éŸ³é¢‘ç„¦ç‚¹

---

## ğŸš€ åç»­ä¼˜åŒ–å»ºè®®

### 1. è¿›åº¦æ¡æ˜¾ç¤º

```xml
<!-- æ·»åŠ è¿›åº¦æ¡ -->
<SeekBar
    android:id="@+id/seekbar_audio"
    android:layout_width="match_parent"
    android:layout_height="wrap_content" />

<TextView
    android:id="@+id/tv_audio_time"
    android:text="00:00 / 00:15" />
```

```java
// æ›´æ–°è¿›åº¦æ¡
@Override
public void onProgress(int current, int duration) {
    seekBar.setMax(duration);
    seekBar.setProgress(current);
    tvTime.setText(formatTime(current) + " / " + formatTime(duration));
}
```

### 2. æ’­æ”¾é€Ÿåº¦æ§åˆ¶

```java
// Android 6.0+ æ”¯æŒ
if (Build.VERSION.SDK_INT >= Build.VERSION_CODES.M) {
    PlaybackParams params = new PlaybackParams();
    params.setSpeed(1.5f); // 1.5å€é€Ÿ
    mediaPlayer.setPlaybackParams(params);
}
```

### 3. ç¦»çº¿ç¼“å­˜

```java
// ä¸‹è½½éŸ³é¢‘åˆ°æœ¬åœ°
DownloadManager downloadManager = (DownloadManager) getSystemService(DOWNLOAD_SERVICE);
Uri uri = Uri.parse(audioUrl);
DownloadManager.Request request = new DownloadManager.Request(uri);
request.setDestinationInExternalFilesDir(this, Environment.DIRECTORY_MUSIC, "daily_sentence.mp3");
downloadManager.enqueue(request);
```

### 4. å¾ªç¯æ’­æ”¾

```java
mediaPlayer.setLooping(true); // å¾ªç¯æ’­æ”¾
```

### 5. éŸ³é¢‘å¯è§†åŒ–

```java
// ä½¿ç”¨Visualizeræ˜¾ç¤ºæ³¢å½¢
Visualizer visualizer = new Visualizer(mediaPlayer.getAudioSessionId());
visualizer.setEnabled(true);
```

---

## ğŸ“ æ–‡ä»¶æ¸…å•

### æ–°å¢æ–‡ä»¶

| æ–‡ä»¶è·¯å¾„ | è¯´æ˜ |
|---------|------|
| `utils/AudioPlayerManager.java` | éŸ³é¢‘æ’­æ”¾ç®¡ç†å™¨ |
| `éŸ³é¢‘æ’­æ”¾åŠŸèƒ½å®ç°æ€»ç»“.md` | æœ¬æ–‡æ¡£ |

### ä¿®æ”¹æ–‡ä»¶

| æ–‡ä»¶è·¯å¾„ | ä¿®æ”¹å†…å®¹ |
|---------|---------|
| `DailySentenceActivity.java` | é›†æˆéŸ³é¢‘æ’­æ”¾åŠŸèƒ½ |

---

## ğŸ¯ åŠŸèƒ½å¯¹æ¯”

| åŠŸèƒ½ | å®ç°å‰ | å®ç°å |
|-----|-------|-------|
| æ’­æ”¾éŸ³é¢‘ | âŒ ä»…æç¤º | âœ… çœŸå®æ’­æ”¾ |
| æš‚åœ/ç»§ç»­ | âŒ æ—  | âœ… æ”¯æŒ |
| çŠ¶æ€æ˜¾ç¤º | âŒ å›ºå®šæ–‡å­— | âœ… åŠ¨æ€æ›´æ–° |
| é”™è¯¯å¤„ç† | âŒ æ—  | âœ… Toastæç¤º |
| ç”Ÿå‘½å‘¨æœŸ | âŒ æ—  | âœ… è‡ªåŠ¨ç®¡ç† |
| è¿›åº¦æ˜¾ç¤º | âŒ æ—  | âœ… å›è°ƒæ”¯æŒ |

---

## âœ¨ æ€»ç»“

### å·²å®ç°åŠŸèƒ½

âœ… éŸ³é¢‘æ’­æ”¾ç®¡ç†å™¨ï¼ˆAudioPlayerManagerï¼‰  
âœ… æ’­æ”¾/æš‚åœ/åœæ­¢æ§åˆ¶  
âœ… åŠ¨æ€æŒ‰é’®çŠ¶æ€æ›´æ–°  
âœ… å®Œå–„çš„é”™è¯¯å¤„ç†  
âœ… ç”Ÿå‘½å‘¨æœŸç®¡ç†  
âœ… è¿›åº¦å›è°ƒæ¥å£  
âœ… Toastç”¨æˆ·æç¤º  

### æŠ€æœ¯äº®ç‚¹

- ğŸ¯ æ™ºèƒ½æ’­æ”¾æ§åˆ¶ï¼ˆæ’­æ”¾/æš‚åœ/åˆ‡æ¢ï¼‰
- ğŸ”„ å®æ—¶çŠ¶æ€æ›´æ–°
- ğŸ›¡ï¸ å®Œå–„çš„é”™è¯¯å¤„ç†
- ğŸ“± ç”Ÿå‘½å‘¨æœŸè‡ªåŠ¨ç®¡ç†
- ğŸ¨ å‹å¥½çš„ç”¨æˆ·ä½“éªŒ
- ğŸ”§ æ˜“äºæ‰©å±•çš„æ¥å£

### ç”¨æˆ·ä½“éªŒæå‡

- **æ“ä½œç›´è§‚**: ç‚¹å‡»æ’­æ”¾ï¼Œå†æ¬¡ç‚¹å‡»æš‚åœ
- **çŠ¶æ€æ¸…æ™°**: æŒ‰é’®æ–‡å­—å®æ—¶åé¦ˆçŠ¶æ€
- **é”™è¯¯å‹å¥½**: å¼‚å¸¸æƒ…å†µæœ‰æ˜ç¡®æç¤º
- **æ€§èƒ½ä¼˜åŒ–**: è‡ªåŠ¨é‡Šæ”¾èµ„æºï¼Œä¸å ç”¨å†…å­˜

---

**éŸ³é¢‘æ’­æ”¾åŠŸèƒ½é›†æˆå®Œæˆï¼** ğŸ‰

ç°åœ¨ç”¨æˆ·å¯ä»¥ç‚¹å‡»æ’­æ”¾æŒ‰é’®å¬å–é‡‘å±±è¯éœ¸æä¾›çš„æ ‡å‡†è‹±è¯­æœ—è¯»ï¼Œæå‡å­¦ä¹ ä½“éªŒï¼

