# 真题批改系统快速测试指南

## ⚡ 5分钟快速测试

### 步骤1：配置API Key（必须）

在测试前，您需要先获取并配置智谱AI的API Key：

#### 1.1 获取API Key

1. 访问：https://open.bigmodel.cn/
2. 注册/登录账号
3. 进入"API Keys"页面
4. 点击"创建新的API Key"
5. 复制生成的API Key

#### 1.2 临时配置（用于测试）

打开文件：`app/src/main/java/com/example/mybighomework/ExamAnswerActivity.java`

找到第186-188行的`initDatabase()`方法：

```java
// 初始化智谱AI服务
SharedPreferences prefs = getSharedPreferences("zhipuai_config", MODE_PRIVATE);
String apiKey = prefs.getString("api_key", "");
zhipuAIService = new ZhipuAIService(apiKey);
```

**临时修改为**（仅用于测试）：

```java
// 初始化智谱AI服务 - 临时硬编码测试
String apiKey = "您的智谱AI_API_KEY";  // 替换为您的实际API Key
zhipuAIService = new ZhipuAIService(apiKey);
```

> ⚠️ **注意**：这只是临时测试方案。生产环境应该通过设置界面让用户输入API Key。

---

### 步骤2：编译运行

```bash
# Windows
gradlew.bat assembleDebug

# Linux/Mac
./gradlew assembleDebug
```

或在Android Studio中点击 `Run` 按钮。

---

### 步骤3：答题测试

1. 打开应用，进入**真题练习**
2. 选择任意试卷（如"2025年考研英语二"）
3. 开始答题：

   **最少答题要求**：
   - 完形填空：随便选3-5题
   - 阅读理解：选2-3题
   - 新题型：选1-2题
   - **翻译**：写一段简单翻译（测试AI批改）
     ```
     例如：This is a test translation.
     这是一个测试翻译。
     ```
   - **写作**：写几句话（测试AI批改）
     ```
     例如：
     Education is important for everyone. 
     We should study hard.
     ```

4. 点击**交卷**按钮

---

### 步骤4：观察批改过程

应该看到以下进度提示：

1. "正在批改试卷，请稍候..."
2. "正在批改翻译题..."
3. "正在批改写作题..."

**预期时间**：10-15秒

---

### 步骤5：检查成绩页面

批改完成后应自动跳转到成绩详情页，检查：

#### ✅ 顶部显示
- [ ] 总分（数字显示）
- [ ] 等级（优秀/良好/及格/不及格）
- [ ] 正确率百分比
- [ ] 考试用时

#### ✅ 各部分得分
- [ ] 完形填空：得分/10，答对数/总数
- [ ] 阅读理解：得分/20，答对数/总数
- [ ] 新题型：得分/10，答对数/总数
- [ ] 翻译：得分/15 + AI评语
- [ ] 写作：得分/15 + AI评语

#### ✅ 功能按钮
- [ ] "查看详情"按钮可点击
- [ ] "加入错题本"按钮可点击
- [ ] "完成"按钮可点击并返回

---

### 步骤6：测试错题本集成

1. 在成绩页面点击**"加入错题本"**
2. 等待提示"已添加 X 道错题到错题本"
3. 返回主页，进入**错题本**
4. 检查是否有新增的错题

---

## 🔍 详细验证清单

### A. 选择题批改验证

打开Logcat，筛选`ExamAnswerActivity`标签：

应该看到类似日志：
```
D/ExamAnswerActivity: 开始批改选择题
D/ExamAnswerActivity: 批改完成 - 完形:3/5, 阅读:2/3, 新题型:1/2
```

**手动验证**：
1. 记下您答对了几题
2. 计算预期分数：
   - 完形：答对数 × 0.5
   - 阅读：答对数 × 1.0
   - 新题型：答对数 × 2.0
3. 对比成绩页面显示的分数

### B. AI批改验证

打开Logcat，筛选`ZhipuAIService`和`ExamAnswerActivity`：

**翻译批改日志**：
```
D/ExamAnswerActivity: 开始AI批改翻译和写作
D/ExamAnswerActivity: 翻译批改完成 - 得分:12.5, 评语:译文准确流畅...
```

**写作批改日志**：
```
D/ExamAnswerActivity: 写作批改完成 - 得分:11.0, 评语:内容基本切题...
```

**验证要点**：
- [ ] 翻译得分在 0-15 之间
- [ ] 写作得分在 0-15 之间
- [ ] 评语内容合理，有具体建议
- [ ] 如果AI批改失败，应显示默认分数10分

### C. 数据库验证

在Android Studio的Database Inspector中查看`exam_results`表：

或使用adb命令：
```bash
adb shell
run-as com.example.mybighomework
cd databases
sqlite3 english_learning_db

# 查询最新一条成绩记录
SELECT * FROM exam_results ORDER BY id DESC LIMIT 1;
```

**验证字段**：
- [ ] totalScore = clozeScore + readingScore + newTypeScore + translationScore + writingScore
- [ ] accuracy = correctAnswers / totalQuestions
- [ ] answerDetails包含JSON格式的答题详情

---

## ❌ 常见问题排查

### 问题1：提示"AI批改失败"

**检查点**：
1. API Key是否正确配置
2. 网络是否连接
3. Logcat中的具体错误信息

**Logcat筛选**：
```
tag:ZhipuAIService OR tag:ExamAnswerActivity
```

**常见错误**：
- `HTTP 401`: API Key错误
- `HTTP 429`: 请求过于频繁
- `IOException`: 网络连接失败

### 问题2：应用崩溃

**可能原因**：
1. 数据库迁移失败
2. 空指针异常
3. JSON解析错误

**解决方案**：
1. 卸载应用重新安装（清除数据库）
2. 查看Logcat完整堆栈信息
3. 检查是否所有文件都已正确创建

### 问题3：成绩不显示

**检查**：
1. `ExamResultActivity`是否在Manifest中注册
2. Intent传递的`result_id`是否正确
3. 数据库中是否有成绩记录

### 问题4：翻译/写作得分为0

**原因**：
- 可能未输入翻译/写作内容
- 或者答案保存失败

**验证**：
在交卷前检查`userAnswers` Map中是否包含翻译/写作的答案。

---

## 📊 测试结果示例

### 正常测试结果

```
=============== 测试结果 ===============
考试标题: 2025年考研英语二
总分: 36.5 / 70
等级: 及格
正确率: 60.0%
用时: 5分30秒

完形填空: 2.0/10 (4/20题正确)
阅读理解: 15.0/20 (15/20题正确)
新题型: 6.0/10 (3/5题正确)
翻译: 12.5/15
  评语: 译文基本准确，但部分用词不够地道...
写作: 11.0/15
  评语: 内容切题，结构清晰，但语法有少量错误...

错题已添加到错题本: 8题
=====================================
```

---

## ✅ 测试完成标准

所有以下项目都通过后，测试完成：

- [ ] API Key配置成功
- [ ] 应用编译运行无错误
- [ ] 能够正常答题
- [ ] 点击交卷后显示批改进度
- [ ] 选择题批改结果正确
- [ ] AI批改翻译和写作（有评语）
- [ ] 成绩页面正常显示
- [ ] 各部分得分计算正确
- [ ] 总分等于各部分之和
- [ ] 错题本功能正常
- [ ] 数据持久化到数据库

---

## 🎯 下一步

测试通过后，您可以：

1. **优化UI**：调整成绩页面的样式
2. **添加历史成绩**：显示历史考试记录
3. **详细解析**：为每题添加详细解析
4. **数据统计**：添加成绩趋势图表
5. **分享功能**：分享考试成绩到社交媒体

---

## 📞 技术支持

如遇到问题，请提供：
1. Logcat完整日志
2. 具体的错误信息
3. 复现步骤
4. 设备和Android版本信息

祝测试顺利！🎉

