# ğŸ“Š å­¦ä¹ è®°å½•å›¾è¡¨æ¶æ„å›¾

## ğŸ—ï¸ æ•´ä½“æ¶æ„

```mermaid
graph TB
    subgraph "UIå±‚ - Presentation Layer"
        A[ReportActivity]
        B[StudyChartView]
    end
    
    subgraph "ä¸šåŠ¡å±‚ - Business Layer"
        C[StudyRecordRepository]
    end
    
    subgraph "æ•°æ®å±‚ - Data Layer"
        D[StudyRecordDao]
        E[SQLite Database]
    end
    
    subgraph "å®ä½“å±‚ - Entity Layer"
        F[StudyRecordEntity]
        G[DailyStudyTime]
    end
    
    A --> B
    A --> C
    C --> D
    D --> E
    D --> G
    E --> F
    
    style B fill:#FF9A6C,stroke:#333,stroke-width:3px,color:#fff
    style C fill:#4CAF50,stroke:#333,stroke-width:2px,color:#fff
    style D fill:#2196F3,stroke:#333,stroke-width:2px,color:#fff
```

---

## ğŸ“Š æ•°æ®æµè½¬è¿‡ç¨‹

```mermaid
sequenceDiagram
    autonumber
    participant User as ç”¨æˆ·
    participant Activity as ReportActivity
    participant Repo as StudyRecordRepository
    participant DAO as StudyRecordDao
    participant DB as SQLite
    participant Chart as StudyChartView
    
    User->>Activity: æ‰“å¼€å­¦ä¹ æŠ¥å‘Šé¡µé¢
    Activity->>Activity: åˆå§‹åŒ–ç»„ä»¶
    Activity->>Repo: getDailyStudyTime(7)
    Repo->>Repo: è®¡ç®—7å¤©å‰çš„æ—¶é—´æˆ³
    Repo->>DAO: getDailyStudyTime(startTime)
    DAO->>DB: æ‰§è¡ŒSQLæŸ¥è¯¢
    Note over DAO,DB: SELECT date, SUM(time)<br/>GROUP BY date
    DB-->>DAO: è¿”å›æŸ¥è¯¢ç»“æœ
    DAO-->>Repo: List<DailyStudyTime>
    Repo-->>Activity: è¿”å›æ•°æ®åˆ—è¡¨
    Activity->>Activity: è½¬æ¢ä¸ºMapæ ¼å¼
    Activity->>Chart: setData(chartData)
    Chart->>Chart: å¤„ç†æ•°æ®
    Chart->>Chart: ç”Ÿæˆæ•°æ®ç‚¹
    Chart->>Chart: ç»˜åˆ¶å›¾è¡¨
    Chart-->>User: æ˜¾ç¤ºå­¦ä¹ æ—¶é•¿å›¾è¡¨
```

---

## ğŸ¨ å›¾è¡¨ç»˜åˆ¶æµç¨‹

```mermaid
flowchart TD
    A[å¼€å§‹ç»˜åˆ¶] --> B[æ£€æŸ¥æ•°æ®æ˜¯å¦ä¸ºç©º]
    B -->|æ˜¯| C[æ˜¾ç¤ºç©ºå›¾è¡¨]
    B -->|å¦| D[è®¡ç®—æœ€å¤§å€¼]
    D --> E[ç»˜åˆ¶ç½‘æ ¼çº¿]
    E --> F[ç»˜åˆ¶å¡«å……åŒºåŸŸ]
    F --> G[ç»˜åˆ¶æ›²çº¿]
    G --> H[ç»˜åˆ¶æ•°æ®ç‚¹]
    H --> I[ç»˜åˆ¶Xè½´æ ‡ç­¾]
    I --> J[ç»˜åˆ¶å½“æ—¥å­¦ä¹ æ—¶é•¿]
    J --> K[å®Œæˆç»˜åˆ¶]
    
    style A fill:#4CAF50,color:#fff
    style K fill:#4CAF50,color:#fff
    style D fill:#FF9A6C,color:#fff
    style G fill:#FF9A6C,color:#fff
```

---

## ğŸ—‚ï¸ ç±»å…³ç³»å›¾

```mermaid
classDiagram
    class ReportActivity {
        -StudyChartView studyChart
        -StudyRecordRepository studyRecordRepository
        -ExecutorService executorService
        +onCreate()
        +initViews()
        +loadReportData()
        +onResume()
        +onDestroy()
    }
    
    class StudyChartView {
        -List~Float~ dataPoints
        -List~String~ dateLabels
        -float maxValue
        -Paint linePaint
        -Paint pointPaint
        -Paint textPaint
        +StudyChartView()
        +setData(Map)
        #onDraw(Canvas)
        -drawGrid(Canvas)
        -drawChart(Canvas)
        -drawDataPoints(Canvas)
        -drawXAxisLabels(Canvas)
        -getYPosition(float)
        -formatTime(float)
    }
    
    class StudyRecordRepository {
        -StudyRecordDao studyRecordDao
        +StudyRecordRepository(StudyRecordDao)
        +getDailyStudyTime(int)
        +getTotalStudyTimeHours()
        +getAllStudyRecords()
    }
    
    class StudyRecordDao {
        <<interface>>
        +getDailyStudyTime(long) List~DailyStudyTime~
        +getTotalStudyTimeHours() double
        +getAllStudyRecords() List~StudyRecordEntity~
    }
    
    class DailyStudyTime {
        +String date
        +double totalSeconds
    }
    
    class StudyRecordEntity {
        +long id
        +int questionId
        +String studyType
        +long responseTime
        +Date studyDate
        +boolean isCorrect
    }
    
    ReportActivity --> StudyChartView : ä½¿ç”¨
    ReportActivity --> StudyRecordRepository : ä¾èµ–
    StudyRecordRepository --> StudyRecordDao : ä¾èµ–
    StudyRecordDao ..> DailyStudyTime : è¿”å›
    StudyRecordDao ..> StudyRecordEntity : è¿”å›
```

---

## ğŸ”„ ç”Ÿå‘½å‘¨æœŸæµç¨‹

```mermaid
stateDiagram-v2
    [*] --> Created: onCreate()
    Created --> Initialized: initViews()
    Initialized --> Loading: loadReportData()
    Loading --> DataFetching: åå°çº¿ç¨‹æŸ¥è¯¢æ•°æ®
    DataFetching --> DataProcessing: å¤„ç†æ•°æ®
    DataProcessing --> UIUpdate: runOnUiThread
    UIUpdate --> Displayed: å›¾è¡¨æ˜¾ç¤º
    Displayed --> Resumed: onResume()
    Resumed --> Loading: é‡æ–°åŠ è½½æ•°æ®
    Displayed --> Destroyed: onDestroy()
    Destroyed --> [*]
    
    note right of Loading
        å¼‚æ­¥æ‰§è¡Œ
        ExecutorService
    end note
    
    note right of UIUpdate
        ä¸»çº¿ç¨‹æ›´æ–°
        studyChart.setData()
    end note
```

---

## ğŸ“Š æ•°æ®æ¨¡å‹å…³ç³»

```mermaid
erDiagram
    StudyRecordEntity ||--o{ DailyStudyTime : "èšåˆ"
    StudyRecordEntity {
        long id PK
        int questionId
        String studyType
        long responseTime
        Date studyDate
        boolean isCorrect
    }
    
    DailyStudyTime {
        String date
        double totalSeconds
    }
    
    ChartData {
        Map date_time
    }
    
    DailyStudyTime ||--|| ChartData : "è½¬æ¢"
```

---

## ğŸ¯ æ¨¡å—ä¾èµ–å…³ç³»

```mermaid
graph LR
    subgraph "appæ¨¡å—"
        A[view/StudyChartView]
        B[ReportActivity]
        C[repository/StudyRecordRepository]
        D[database/dao/StudyRecordDao]
        E[database/entity/StudyRecordEntity]
        F[database/AppDatabase]
    end
    
    B --> A
    B --> C
    C --> D
    D --> E
    D --> F
    
    style A fill:#FF9A6C,color:#fff
    style B fill:#4CAF50,color:#fff
    style C fill:#2196F3,color:#fff
    style D fill:#9C27B0,color:#fff
```

---

## ğŸ¨ å›¾è¡¨ç»˜åˆ¶è¯¦ç»†æµç¨‹

```mermaid
flowchart TD
    subgraph "æ•°æ®å‡†å¤‡é˜¶æ®µ"
        A1[æ¥æ”¶Mapæ•°æ®] --> A2[ç”Ÿæˆ7å¤©æ—¥æœŸ]
        A2 --> A3[åŒ¹é…æ—¥æœŸæ•°æ®]
        A3 --> A4[å¡«å……ç¼ºå¤±æ•°æ®ä¸º0]
        A4 --> A5[è®¡ç®—æœ€å¤§å€¼]
        A5 --> A6[æ ¼å¼åŒ–æ—¥æœŸæ ‡ç­¾]
    end
    
    subgraph "ç»˜åˆ¶å‡†å¤‡é˜¶æ®µ"
        B1[è®¡ç®—å›¾è¡¨å°ºå¯¸] --> B2[è®¡ç®—æ•°æ®ç‚¹åæ ‡]
        B2 --> B3[ç”ŸæˆPathè·¯å¾„]
    end
    
    subgraph "Canvasç»˜åˆ¶é˜¶æ®µ"
        C1[ç»˜åˆ¶æ°´å¹³ç½‘æ ¼çº¿] --> C2[ç»˜åˆ¶å¡«å……åŒºåŸŸPath]
        C2 --> C3[ç»˜åˆ¶æ›²çº¿Path]
        C3 --> C4[ç»˜åˆ¶æ•°æ®ç‚¹åœ†åœˆ]
        C4 --> C5[ç»˜åˆ¶æ—¥æœŸæ–‡æœ¬]
        C5 --> C6[ç»˜åˆ¶æ ‡é¢˜æ–‡æœ¬]
    end
    
    A6 --> B1
    B3 --> C1
    
    style A5 fill:#FF9A6C,color:#fff
    style C3 fill:#FF9A6C,color:#fff
```

---

## ğŸ“Š åæ ‡è®¡ç®—é€»è¾‘

```mermaid
graph TB
    subgraph "Xåæ ‡è®¡ç®—"
        X1["chartWidth = æ€»å®½åº¦ - å·¦å³è¾¹è·"]
        X2["stepX = chartWidth / (ç‚¹æ•°-1)"]
        X3["x = paddingLeft + stepX * i"]
    end
    
    subgraph "Yåæ ‡è®¡ç®—"
        Y1["chartHeight = æ€»é«˜åº¦ - ä¸Šä¸‹è¾¹è·"]
        Y2["ratio = value / maxValue"]
        Y3["y = paddingTop + chartHeight - chartHeight * ratio"]
    end
    
    X1 --> X2 --> X3
    Y1 --> Y2 --> Y3
    
    style X3 fill:#4CAF50,color:#fff
    style Y3 fill:#4CAF50,color:#fff
```

---

## ğŸ¨ ç»˜åˆ¶å±‚çº§å…³ç³»

```mermaid
graph TB
    A[Canvasç”»å¸ƒ] --> B[ç½‘æ ¼çº¿å±‚]
    A --> C[å¡«å……åŒºåŸŸå±‚]
    A --> D[æ›²çº¿å±‚]
    A --> E[æ•°æ®ç‚¹å±‚]
    A --> F[æ–‡æœ¬å±‚]
    
    B --> B1[æ°´å¹³ç½‘æ ¼çº¿]
    C --> C1[åŠé€æ˜æ©™è‰²å¡«å……]
    D --> D1[æ©™è‰²æ›²çº¿]
    E --> E1[ç™½è‰²å¤–åœˆ]
    E --> E2[æ©™è‰²å†…åœˆ]
    F --> F1[æ—¥æœŸæ ‡ç­¾]
    F --> F2[æ ‡é¢˜æ–‡æœ¬]
    
    style D fill:#FF9A6C,color:#fff
    style C fill:#FF9A6C,color:#fff
    style E fill:#FF9A6C,color:#fff
```

---

## ğŸ”§ é…ç½®ä¸æ‰©å±•ç‚¹

```mermaid
mindmap
  root((StudyChartView))
    é¢œè‰²é…ç½®
      lineColor
      pointColor
      fillColor
      textColor
      gridColor
    å°ºå¯¸é…ç½®
      paddingLeft
      paddingRight
      paddingTop
      paddingBottom
    ç»˜åˆ¶é…ç½®
      çº¿å®½ strokeWidth
      ç‚¹åŠå¾„ radius
      æ–‡å­—å¤§å° textSize
    æ•°æ®é…ç½®
      æ•°æ®ç‚¹åˆ—è¡¨
      æ—¥æœŸæ ‡ç­¾
      æœ€å¤§å€¼
    æ‰©å±•åŠŸèƒ½
      åŠ¨ç”»æ•ˆæœ
      äº¤äº’äº‹ä»¶
      ä¸»é¢˜åˆ‡æ¢
      æ•°æ®åˆ·æ–°
```

---

## ğŸ“± UIç»„ä»¶æ ‘

```mermaid
graph TD
    A[activity_report.xml] --> B[NestedScrollView]
    B --> C[LinearLayoutä¸»å®¹å™¨]
    
    C --> D[å­¦ä¹ æ¦‚è§ˆå¡ç‰‡]
    C --> E[å­¦ä¹ è¿›åº¦å›¾è¡¨å¡ç‰‡]
    C --> F[æ¨¡å—ç»Ÿè®¡å¡ç‰‡]
    C --> G[å­¦ä¹ å»ºè®®å¡ç‰‡]
    
    E --> H[æ ‡é¢˜åŒºåŸŸ]
    E --> I[StudyChartView]
    
    H --> H1[å­¦ä¹ è¿›åº¦å›¾è¡¨æ ‡é¢˜]
    H --> H2[æœ€è¿‘7å¤©å‰¯æ ‡é¢˜]
    
    style I fill:#FF9A6C,color:#fff,stroke:#333,stroke-width:3px
    style E fill:#E3F2FD
```

---

## ğŸš€ æ€§èƒ½ä¼˜åŒ–æ¶æ„

```mermaid
flowchart LR
    subgraph "æ•°æ®å±‚ä¼˜åŒ–"
        A1[æ•°æ®åº“ç´¢å¼•] --> A2[SQLæŸ¥è¯¢ä¼˜åŒ–]
        A2 --> A3[ç»“æœé›†ç¼“å­˜]
    end
    
    subgraph "ä¸šåŠ¡å±‚ä¼˜åŒ–"
        B1[åå°çº¿ç¨‹] --> B2[æ•°æ®é¢„å¤„ç†]
        B2 --> B3[Mapè½¬æ¢]
    end
    
    subgraph "UIå±‚ä¼˜åŒ–"
        C1[ä¸»çº¿ç¨‹æ›´æ–°] --> C2[ç¡¬ä»¶åŠ é€Ÿ]
        C2 --> C3[å‡å°‘é‡ç»˜]
    end
    
    A3 --> B1
    B3 --> C1
    
    style A2 fill:#4CAF50,color:#fff
    style B1 fill:#FF9A6C,color:#fff
    style C2 fill:#2196F3,color:#fff
```

---

## ğŸ“Š æ€»ç»“

æœ¬æ¶æ„å›¾å±•ç¤ºäº†å­¦ä¹ è®°å½•å›¾è¡¨åŠŸèƒ½çš„å®Œæ•´æŠ€æœ¯æ¶æ„ï¼ŒåŒ…æ‹¬ï¼š

- âœ… **åˆ†å±‚æ¶æ„**ï¼šæ¸…æ™°çš„UIå±‚ã€ä¸šåŠ¡å±‚ã€æ•°æ®å±‚åˆ†ç¦»
- âœ… **æ•°æ®æµè½¬**ï¼šä»æ•°æ®åº“åˆ°UIçš„å®Œæ•´æ•°æ®é“¾è·¯
- âœ… **ç»˜åˆ¶æµç¨‹**ï¼šè¯¦ç»†çš„Canvasç»˜åˆ¶æ­¥éª¤
- âœ… **ç±»å…³ç³»**ï¼šå„ç»„ä»¶ä¹‹é—´çš„ä¾èµ–å…³ç³»
- âœ… **æ€§èƒ½ä¼˜åŒ–**ï¼šå¤šå±‚æ¬¡çš„æ€§èƒ½ä¼˜åŒ–ç­–ç•¥

è¿™ç§æ¶æ„è®¾è®¡ç¡®ä¿äº†ä»£ç çš„å¯ç»´æŠ¤æ€§ã€å¯æ‰©å±•æ€§å’Œé«˜æ€§èƒ½ã€‚

