# 音频播放功能测试指南

## 📋 测试目标

验证每日一句的音频播放功能是否正常工作，包括播放、暂停、错误处理等。

---

## 🧪 测试环境

- **Android版本**: Android 7.0 (API 24) 及以上
- **网络要求**: 需要联网
- **音频**: 金山词霸TTS音频

---

## 📝 快速测试步骤

### 步骤1: 启动应用

```bash
# 在Android Studio中运行应用
或者
# 命令行安装
adb install -r app/build/outputs/apk/debug/app-debug.apk
```

### 步骤2: 打开Logcat

```bash
# 过滤AudioPlayerManager日志
adb logcat | grep AudioPlayerManager
```

### 步骤3: 进入每日一句

1. 启动应用
2. 点击主页的"每日一句"功能
3. 等待页面加载

### 步骤4: 测试播放

点击"▶ 播放"按钮，观察：

**预期现象**:
- [ ] 按钮变为"加载中..."（灰色）
- [ ] 1-2秒后变为"⏸ 暂停"
- [ ] 能听到英文朗读声音
- [ ] 播放完成后按钮恢复"▶ 播放"

**Logcat输出**:
```
D/AudioPlayerManager: 开始准备音频: http://news.iciba.com/...
D/AudioPlayerManager: 音频准备完成，开始播放
```

---

## 🔍 详细测试用例

### 用例1: 正常播放

**测试步骤**:
1. 打开每日一句页面
2. 观察是否显示播放按钮
3. 点击"播放"按钮
4. 等待音频加载
5. 听完整个句子

**检查点**:
- [ ] 按钮初始显示"▶ 播放"
- [ ] 点击后显示"加载中..."
- [ ] 加载完成显示"⏸ 暂停"
- [ ] 能听到清晰的英文朗读
- [ ] 播放结束显示Toast"播放完成"
- [ ] 按钮恢复为"▶ 播放"

**日志关键字**:
```
AudioPlayerManager: 开始准备音频
AudioPlayerManager: 音频准备完成，开始播放
AudioPlayerManager: 音频播放完成
```

---

### 用例2: 暂停功能

**测试步骤**:
1. 播放音频（按钮显示"⏸ 暂停"）
2. 点击"暂停"按钮
3. 观察按钮变化
4. 再次点击"播放"按钮

**检查点**:
- [ ] 第一次点击：音频停止，按钮变为"▶ 播放"
- [ ] 音频确实暂停（声音停止）
- [ ] 第二次点击：音频继续，按钮变为"⏸ 暂停"
- [ ] 从暂停位置继续播放

**日志关键字**:
```
AudioPlayerManager: 暂停播放
AudioPlayerManager: 恢复播放
```

---

### 用例3: 切换句子

**测试步骤**:
1. 播放当前句子
2. 向下滚动到历史记录
3. 点击历史记录中的某个句子
4. 点击播放按钮

**检查点**:
- [ ] 当前音频停止
- [ ] 新音频开始加载
- [ ] 播放新句子的音频
- [ ] 按钮状态正常切换

**日志关键字**:
```
AudioPlayerManager: 停止播放
AudioPlayerManager: 开始准备音频
```

---

### 用例4: 网络异常

**测试步骤**:
1. 清除应用数据（确保无缓存）
2. 关闭网络（飞行模式）
3. 打开每日一句页面
4. 点击播放按钮

**检查点**:
- [ ] 显示Toast: "播放失败，请检查网络"
- [ ] 按钮恢复为"▶ 播放"
- [ ] 应用不崩溃

**日志关键字**:
```
AudioPlayerManager: 播放异常
AudioPlayerManager: 停止播放
```

---

### 用例5: 无音频URL

**测试步骤**:
1. 找一个没有音频URL的句子（旧数据）
2. 点击播放按钮

**检查点**:
- [ ] 显示Toast: "该句子暂无音频"
- [ ] 按钮保持"▶ 播放"状态
- [ ] 应用不崩溃

---

### 用例6: 生命周期测试

**测试步骤**:
1. 播放音频
2. 按Home键（切到后台）
3. 观察音频状态
4. 再次打开应用

**检查点**:
- [ ] 切到后台时自动暂停
- [ ] 按钮变为"▶ 播放"
- [ ] 恢复应用后可以继续播放
- [ ] 无资源泄漏

**日志关键字**:
```
AudioPlayerManager: 暂停播放
```

---

### 用例7: 快速点击

**测试步骤**:
1. 快速连续点击播放按钮3-5次

**检查点**:
- [ ] 应用不崩溃
- [ ] 按钮状态正常
- [ ] 音频状态正常（播放或暂停）
- [ ] 无内存泄漏

---

### 用例8: 旋转屏幕

**测试步骤**:
1. 播放音频
2. 旋转屏幕（横屏/竖屏）
3. 观察音频状态

**检查点**:
- [ ] 旋转后音频继续播放（如果正在播放）
- [ ] 旋转后按钮状态保持
- [ ] 无崩溃

---

## 📊 性能测试

### 1. 加载时间

**测试方法**:
```bash
# 查看时间戳
adb logcat -v time | grep AudioPlayerManager
```

**指标**:
- 准备时间 < 3秒
- 播放响应 < 100ms

**示例日志**:
```
10-09 14:30:00.123 D/AudioPlayerManager: 开始准备音频
10-09 14:30:02.456 D/AudioPlayerManager: 音频准备完成
# 准备时间: 2.3秒 ✅
```

### 2. 内存占用

**测试方法**:
```bash
# 播放前
adb shell dumpsys meminfo com.example.mybighomework | grep TOTAL

# 播放中
adb shell dumpsys meminfo com.example.mybighomework | grep TOTAL

# 播放后
adb shell dumpsys meminfo com.example.mybighomework | grep TOTAL
```

**指标**:
- 播放时增加内存 < 10MB
- 停止后内存恢复

### 3. CPU使用

**测试方法**:
```bash
adb shell top -m 10 | grep mybighomework
```

**指标**:
- 播放时CPU < 5%
- 空闲时CPU < 1%

---

## 🐛 常见问题排查

### 问题1: 点击播放无反应

**现象**: 点击播放按钮后没有任何变化

**排查步骤**:
1. 检查Logcat是否有错误
2. 确认音频URL是否存在
3. 检查网络连接
4. 查看按钮是否被禁用

**解决方案**:
```java
// 检查audioUrl
Log.d("DEBUG", "audioUrl: " + currentSentence.getAudioUrl());

// 检查网络
ConnectivityManager cm = (ConnectivityManager) getSystemService(CONNECTIVITY_SERVICE);
NetworkInfo activeNetwork = cm.getActiveNetworkInfo();
boolean isConnected = activeNetwork != null && activeNetwork.isConnectedOrConnecting();
```

### 问题2: 播放卡顿

**现象**: 音频播放不流畅，有卡顿

**可能原因**:
- 网络速度慢
- 设备性能不足
- 后台进程过多

**解决方案**:
- 使用更快的网络
- 关闭其他应用
- 增加缓冲时间

### 问题3: 按钮状态不更新

**现象**: 播放状态改变但按钮文字不变

**排查步骤**:
1. 检查是否在主线程更新UI
2. 确认监听器是否正确设置

**解决方案**:
```java
// 确保在主线程更新
runOnUiThread(() -> {
    btnPlayAudio.setText("⏸ 暂停");
});
```

### 问题4: 内存泄漏

**现象**: 长时间使用后应用变慢或崩溃

**排查步骤**:
1. 使用Android Profiler检查内存
2. 确认MediaPlayer是否正确释放

**解决方案**:
```java
// 确保在onDestroy中释放
@Override
protected void onDestroy() {
    if (audioPlayerManager != null) {
        audioPlayerManager.release();
        audioPlayerManager = null;
    }
}
```

---

## 📈 测试报告模板

### 测试信息

| 项目 | 内容 |
|-----|------|
| 测试人员 | ____________ |
| 测试日期 | ____________ |
| 测试设备 | ____________ |
| Android版本 | ____________ |
| 应用版本 | ____________ |

### 测试结果

| 测试用例 | 结果 | 备注 |
|---------|------|------|
| 正常播放 | ☐ 通过 ☐ 失败 | |
| 暂停功能 | ☐ 通过 ☐ 失败 | |
| 切换句子 | ☐ 通过 ☐ 失败 | |
| 网络异常 | ☐ 通过 ☐ 失败 | |
| 无音频URL | ☐ 通过 ☐ 失败 | |
| 生命周期 | ☐ 通过 ☐ 失败 | |
| 快速点击 | ☐ 通过 ☐ 失败 | |
| 旋转屏幕 | ☐ 通过 ☐ 失败 | |

### 性能指标

| 指标 | 期望值 | 实际值 | 结果 |
|-----|-------|--------|------|
| 加载时间 | < 3秒 | ___秒 | ☐ 通过 ☐ 失败 |
| 内存增加 | < 10MB | ___MB | ☐ 通过 ☐ 失败 |
| CPU使用 | < 5% | ___%  | ☐ 通过 ☐ 失败 |

### 发现的问题

1. ________________________________________________
2. ________________________________________________
3. ________________________________________________

### 测试结论

☐ 全部通过，可以发布  
☐ 部分失败，需要修复  
☐ 严重问题，不建议发布

---

## ✅ 测试检查清单

### 功能测试
- [ ] 播放功能正常
- [ ] 暂停功能正常
- [ ] 停止功能正常
- [ ] 切换功能正常
- [ ] 按钮状态更新正常

### 异常测试
- [ ] 网络异常处理正常
- [ ] 无音频URL提示正常
- [ ] 音频加载失败提示正常
- [ ] 应用无崩溃

### 性能测试
- [ ] 加载速度达标
- [ ] 内存占用正常
- [ ] CPU使用正常
- [ ] 无内存泄漏

### 兼容性测试
- [ ] 不同设备正常
- [ ] 不同Android版本正常
- [ ] 横竖屏切换正常
- [ ] 生命周期处理正常

### 用户体验
- [ ] 操作流畅
- [ ] 提示明确
- [ ] 无明显卡顿
- [ ] 界面友好

---

## 🎯 自动化测试建议

### 单元测试

```java
@Test
public void testAudioPlayerPlay() {
    AudioPlayerManager manager = new AudioPlayerManager();
    String testUrl = "http://test.com/audio.mp3";
    
    manager.play(testUrl);
    
    assertTrue(manager.isPreparing() || manager.isPlaying());
}

@Test
public void testAudioPlayerPause() {
    // ... 测试暂停功能
}
```

### UI测试

```java
@Test
public void testPlayButtonClick() {
    onView(withId(R.id.btn_play_audio))
        .perform(click());
    
    // 验证按钮文字改变
    onView(withId(R.id.btn_play_audio))
        .check(matches(withText("加载中...")));
}
```

---

**测试完成后，请填写测试报告并提交！** 📝

