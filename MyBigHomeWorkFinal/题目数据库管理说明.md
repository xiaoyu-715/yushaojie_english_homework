# é¢˜ç›®æ•°æ®åº“ç®¡ç†è¯´æ˜

## ğŸ“š ç³»ç»Ÿæ¦‚è¿°

ç°åœ¨æ‰€æœ‰çš„é¢˜ç›®éƒ½å·²ç»å­˜å‚¨åœ¨æ•°æ®åº“ä¸­ï¼Œæ‚¨å¯ä»¥æ–¹ä¾¿åœ°è¿›è¡ŒæŸ¥çœ‹ã€æ·»åŠ ã€ä¿®æ”¹å’Œåˆ é™¤æ“ä½œã€‚

## ğŸ—‚ï¸ æ•°æ®åº“ç»“æ„

### é¢˜ç›®è¡¨ (questions)

| å­—æ®µ | ç±»å‹ | è¯´æ˜ |
|------|------|------|
| id | int | é¢˜ç›®IDï¼ˆè‡ªåŠ¨ç”Ÿæˆï¼‰ |
| questionText | String | é¢˜ç›®å†…å®¹ |
| options | String[] | å››ä¸ªé€‰é¡¹ |
| correctAnswer | int | æ­£ç¡®ç­”æ¡ˆç´¢å¼•(0-3) |
| explanation | String | ç­”æ¡ˆè§£æ |
| category | String | é¢˜ç›®åˆ†ç±»ï¼ˆè¯æ±‡ã€è¯­æ³•ã€é˜…è¯»ç­‰ï¼‰ |
| examType | String | è€ƒè¯•ç±»å‹ï¼ˆå››å…­çº§ï¼‰ |
| source | String | æ¥æºï¼ˆè¯æ±‡è®­ç»ƒã€çœŸé¢˜ç»ƒä¹ ã€æ¨¡æ‹Ÿè€ƒè¯•ï¼‰ |
| difficulty | String | éš¾åº¦ï¼ˆeasyã€mediumã€hardï¼‰ |
| isActive | boolean | æ˜¯å¦å¯ç”¨ |
| totalAttempts | int | æ€»ç­”é¢˜æ¬¡æ•° |
| correctAttempts | int | æ­£ç¡®æ¬¡æ•° |
| accuracyRate | double | æ­£ç¡®ç‡ |

## ğŸ”§ ç®¡ç†æ–¹å¼

### æ–¹å¼ä¸€ï¼šä½¿ç”¨QuestionDataInitializerï¼ˆæ¨èç”¨äºæ‰¹é‡æ›´æ–°ï¼‰

1. **ä¿®æ”¹é¢˜ç›®æ•°æ®**
   
   æ‰“å¼€æ–‡ä»¶ï¼š`app/src/main/java/com/example/mybighomework/utils/QuestionDataInitializer.java`

2. **æ›´æ–°è¯æ±‡è®­ç»ƒé¢˜ç›®**
   
   æ‰¾åˆ° `initializeVocabularyQuestions()` æ–¹æ³•ï¼Œä¿®æ”¹æˆ–æ·»åŠ é¢˜ç›®ï¼š
   
   ```java
   questions.add(createVocabularyQuestion(
       "æ–°å•è¯", "[éŸ³æ ‡]", "ä¸­æ–‡é‡Šä¹‰",
       new String[]{"é€‰é¡¹A", "é€‰é¡¹B", "é€‰é¡¹C", "é€‰é¡¹D"}, 
       0  // æ­£ç¡®ç­”æ¡ˆç´¢å¼•
   ));
   ```

3. **æ›´æ–°çœŸé¢˜ç»ƒä¹ é¢˜ç›®**
   
   æ‰¾åˆ° `initializeExamPracticeQuestions()` æ–¹æ³•ï¼Œä¿®æ”¹æˆ–æ·»åŠ é¢˜ç›®ï¼š
   
   ```java
   questions.add(createExamQuestion(
       "é¢˜ç›®å†…å®¹ï¼Œç©ºæ ¼ç”¨ _______ è¡¨ç¤º",
       new String[]{"é€‰é¡¹A", "é€‰é¡¹B", "é€‰é¡¹C", "é€‰é¡¹D"},
       0,  // æ­£ç¡®ç­”æ¡ˆç´¢å¼•
       "ç­”æ¡ˆè§£æ",
       "è¯æ±‡",  // åˆ†ç±»
       "çœŸé¢˜ç»ƒä¹ "  // æ¥æº
   ));
   ```

4. **æ›´æ–°æ¨¡æ‹Ÿè€ƒè¯•é¢˜ç›®**
   
   æ‰¾åˆ° `initializeMockExamQuestions()` æ–¹æ³•ï¼Œç±»ä¼¼ä¸Šé¢çš„æ–¹å¼æ·»åŠ é¢˜ç›®ã€‚

5. **å¼ºåˆ¶é‡æ–°åˆå§‹åŒ–æ•°æ®**
   
   ä¿®æ”¹å®Œæˆåï¼Œæœ‰ä¸¤ç§æ–¹å¼æ›´æ–°æ•°æ®åº“ï¼š
   
   **æ–¹å¼Aï¼šä¿®æ”¹æ•°æ®ç‰ˆæœ¬å·ï¼ˆæ¨èï¼‰**
   ```java
   private static final int CURRENT_DATA_VERSION = 3; // å¢åŠ ç‰ˆæœ¬å·
   ```
   
   **æ–¹å¼Bï¼šåœ¨MainActivityä¸­è°ƒç”¨å¼ºåˆ¶åˆå§‹åŒ–**
   ```java
   QuestionDataInitializer.forceReinitialize(getApplication());
   ```

### æ–¹å¼äºŒï¼šä½¿ç”¨QuestionRepositoryï¼ˆæ¨èç”¨äºå•ä¸ªé¢˜ç›®ç®¡ç†ï¼‰

åœ¨ä»£ç ä¸­ç›´æ¥æ“ä½œæ•°æ®åº“ï¼š

```java
// 1. åˆ›å»ºRepository
QuestionRepository repository = new QuestionRepository(getApplication());

// 2. æ·»åŠ é¢˜ç›®
QuestionEntity question = new QuestionEntity();
question.setQuestionText("é¢˜ç›®å†…å®¹");
question.setOptions(new String[]{"A", "B", "C", "D"});
question.setCorrectAnswer(0);
question.setExplanation("è§£æ");
question.setCategory("è¯æ±‡");
question.setExamType("å››å…­çº§");
question.setSource("çœŸé¢˜ç»ƒä¹ ");

repository.insertQuestion(question, new QuestionRepository.OnOperationCompleteListener() {
    @Override
    public void onSuccess(String message) {
        Toast.makeText(context, message, Toast.LENGTH_SHORT).show();
    }
    
    @Override
    public void onError(String error) {
        Toast.makeText(context, error, Toast.LENGTH_SHORT).show();
    }
});

// 3. æŸ¥è¯¢é¢˜ç›®
repository.getQuestionsBySource("çœŸé¢˜ç»ƒä¹ ", new QuestionRepository.OnDataLoadListener<List<QuestionEntity>>() {
    @Override
    public void onDataLoaded(List<QuestionEntity> data) {
        // å¤„ç†æŸ¥è¯¢ç»“æœ
    }
    
    @Override
    public void onError(String error) {
        // å¤„ç†é”™è¯¯
    }
});

// 4. æ›´æ–°é¢˜ç›®
question.setQuestionText("ä¿®æ”¹åçš„é¢˜ç›®");
repository.updateQuestion(question, listener);

// 5. åˆ é™¤é¢˜ç›®
repository.deleteQuestion(question, listener);
```

### æ–¹å¼ä¸‰ï¼šä½¿ç”¨QuestionManagementActivityï¼ˆå¯è§†åŒ–ç®¡ç†ï¼‰

1. **è®¿é—®ç®¡ç†é¡µé¢**
   
   åœ¨MainActivityä¸­æ·»åŠ å…¥å£ï¼š
   ```java
   findViewById(R.id.btn_manage_questions).setOnClickListener(v -> {
       startActivity(new Intent(this, QuestionManagementActivity.class));
   });
   ```

2. **åŠŸèƒ½è¯´æ˜**
   - ç­›é€‰é¢˜ç›®ï¼šæŒ‰æ¥æºå’Œåˆ†ç±»ç­›é€‰
   - æŸ¥çœ‹è¯¦æƒ…ï¼šç‚¹å‡»é¢˜ç›®æŸ¥çœ‹å®Œæ•´ä¿¡æ¯å’Œç»Ÿè®¡æ•°æ®
   - æ·»åŠ é¢˜ç›®ï¼šç‚¹å‡»"æ·»åŠ é¢˜ç›®"æŒ‰é’®
   - åˆ é™¤é¢˜ç›®ï¼šé•¿æŒ‰é¢˜ç›®è¿›è¡Œåˆ é™¤

## ğŸ“– å¸¸è§æ“ä½œç¤ºä¾‹

### ç¤ºä¾‹1ï¼šæ‰¹é‡æ·»åŠ è¯æ±‡é¢˜

```java
List<QuestionEntity> questions = new ArrayList<>();

// å‡†å¤‡é¢˜ç›®æ•°æ®
String[][] vocabData = {
    {"word1", "[éŸ³æ ‡1]", "é‡Šä¹‰1", "Aé€‰é¡¹", "Bé€‰é¡¹", "Cé€‰é¡¹", "Dé€‰é¡¹", "0"},
    {"word2", "[éŸ³æ ‡2]", "é‡Šä¹‰2", "Aé€‰é¡¹", "Bé€‰é¡¹", "Cé€‰é¡¹", "Dé€‰é¡¹", "1"},
    // ... æ›´å¤šé¢˜ç›®
};

for (String[] data : vocabData) {
    QuestionEntity q = new QuestionEntity();
    q.setQuestionText(data[0] + " " + data[1]);
    q.setOptions(new String[]{data[3], data[4], data[5], data[6]});
    q.setCorrectAnswer(Integer.parseInt(data[7]));
    q.setExplanation(data[2]);
    q.setCategory("è¯æ±‡");
    q.setExamType("å››å…­çº§");
    q.setSource("è¯æ±‡è®­ç»ƒ");
    questions.add(q);
}

repository.insertQuestions(questions, listener);
```

### ç¤ºä¾‹2ï¼šæœç´¢é¢˜ç›®

```java
repository.searchQuestions("ç¯å¢ƒ", new QuestionRepository.OnDataLoadListener<List<QuestionEntity>>() {
    @Override
    public void onDataLoaded(List<QuestionEntity> data) {
        // æ˜¾ç¤ºæœç´¢ç»“æœ
        for (QuestionEntity q : data) {
            Log.d("Search", q.getQuestionText());
        }
    }
    
    @Override
    public void onError(String error) {
        Log.e("Search", error);
    }
});
```

### ç¤ºä¾‹3ï¼šè·å–éšæœºé¢˜ç›®

```java
// è·å–10ä¸ªéšæœºè¯æ±‡é¢˜
repository.getRandomQuestions("è¯æ±‡", "å››å…­çº§", 10, 
    new QuestionRepository.OnDataLoadListener<List<QuestionEntity>>() {
        @Override
        public void onDataLoaded(List<QuestionEntity> data) {
            // ä½¿ç”¨éšæœºé¢˜ç›®è¿›è¡Œç»ƒä¹ 
        }
        
        @Override
        public void onError(String error) {
            // å¤„ç†é”™è¯¯
        }
    });
```

### ç¤ºä¾‹4ï¼šæŸ¥è¯¢ç»Ÿè®¡ä¿¡æ¯

```java
// è·å–é¢˜ç›®æ€»æ•°
repository.getTotalQuestionCount(new QuestionRepository.OnCountLoadListener() {
    @Override
    public void onCountLoaded(int count) {
        Toast.makeText(context, "é¢˜åº“å…±æœ‰ " + count + " é“é¢˜", Toast.LENGTH_SHORT).show();
    }
    
    @Override
    public void onError(String error) {
        // å¤„ç†é”™è¯¯
    }
});
```

## ğŸ¯ Activityä¸­ä½¿ç”¨æ•°æ®åº“é¢˜ç›®

### VocabularyActivityï¼ˆè¯æ±‡è®­ç»ƒï¼‰

```java
// åœ¨initVocabularyData()æ–¹æ³•ä¸­ï¼š
private void initVocabularyData() {
    QuestionRepository repository = new QuestionRepository(getApplication());
    
    repository.getRandomQuestions("è¯æ±‡", "å››å…­çº§", 10, 
        new QuestionRepository.OnDataLoadListener<List<QuestionEntity>>() {
            @Override
            public void onDataLoaded(List<QuestionEntity> data) {
                runOnUiThread(() -> {
                    vocabularyList.clear();
                    for (QuestionEntity q : data) {
                        // è½¬æ¢ä¸ºVocabularyItem
                        VocabularyItem item = new VocabularyItem(
                            q.getQuestionText().split(" ")[0],  // å•è¯
                            q.getQuestionText().split(" ")[1],  // éŸ³æ ‡
                            q.getExplanation(),
                            q.getOptions(),
                            q.getCorrectAnswer()
                        );
                        vocabularyList.add(item);
                    }
                    totalQuestions = vocabularyList.size();
                    showCurrentQuestion();
                });
            }
            
            @Override
            public void onError(String error) {
                runOnUiThread(() -> Toast.makeText(VocabularyActivity.this, 
                    error, Toast.LENGTH_SHORT).show());
            }
        });
}
```

### ExamPracticeActivityï¼ˆçœŸé¢˜ç»ƒä¹ ï¼‰

```java
private void initExamData() {
    QuestionRepository repository = new QuestionRepository(getApplication());
    
    repository.getRandomQuestionsByExamType("å››å…­çº§", 20,
        new QuestionRepository.OnDataLoadListener<List<QuestionEntity>>() {
            @Override
            public void onDataLoaded(List<QuestionEntity> data) {
                runOnUiThread(() -> {
                    examQuestions.clear();
                    for (QuestionEntity q : data) {
                        if (q.getSource().equals("çœŸé¢˜ç»ƒä¹ ")) {
                            ExamQuestion item = new ExamQuestion(
                                q.getQuestionText(),
                                q.getOptions(),
                                q.getCorrectAnswer(),
                                q.getExplanation()
                            );
                            examQuestions.add(item);
                        }
                    }
                    totalQuestions = Math.min(examQuestions.size(), 20);
                    showCurrentQuestion();
                });
            }
            
            @Override
            public void onError(String error) {
                runOnUiThread(() -> Toast.makeText(ExamPracticeActivity.this, 
                    error, Toast.LENGTH_SHORT).show());
            }
        });
}
```

### MockExamActivityï¼ˆæ¨¡æ‹Ÿè€ƒè¯•ï¼‰

```java
private void initMockExamData() {
    QuestionRepository repository = new QuestionRepository(getApplication());
    
    repository.getRandomQuestionsByExamType("å››å…­çº§", 30,
        new QuestionRepository.OnDataLoadListener<List<QuestionEntity>>() {
            @Override
            public void onDataLoaded(List<QuestionEntity> data) {
                runOnUiThread(() -> {
                    mockQuestions.clear();
                    for (QuestionEntity q : data) {
                        if (q.getSource().equals("æ¨¡æ‹Ÿè€ƒè¯•")) {
                            MockQuestion item = new MockQuestion(
                                q.getQuestionText(),
                                q.getOptions(),
                                q.getCorrectAnswer(),
                                q.getExplanation(),
                                q.getCategory()
                            );
                            mockQuestions.add(item);
                        }
                    }
                    totalQuestions = Math.min(mockQuestions.size(), 30);
                    Collections.shuffle(mockQuestions);
                    showCurrentQuestion();
                });
            }
            
            @Override
            public void onError(String error) {
                runOnUiThread(() -> Toast.makeText(MockExamActivity.this, 
                    error, Toast.LENGTH_SHORT).show());
            }
        });
}
```

## âš ï¸ æ³¨æ„äº‹é¡¹

1. **æ•°æ®åˆå§‹åŒ–æ—¶æœº**
   - åº”ç”¨é¦–æ¬¡å¯åŠ¨æ—¶è‡ªåŠ¨åˆå§‹åŒ–
   - ä¿®æ”¹`CURRENT_DATA_VERSION`åè‡ªåŠ¨æ›´æ–°

2. **æ•°æ®å¤‡ä»½**
   - æ•°æ®åº“æ–‡ä»¶ä½ç½®ï¼š`/data/data/com.example.mybighomework/databases/english_learning_db`
   - å»ºè®®å®šæœŸå¤‡ä»½æ•°æ®

3. **å¹¶å‘å®‰å…¨**
   - æ‰€æœ‰æ•°æ®åº“æ“ä½œéƒ½åœ¨åå°çº¿ç¨‹æ‰§è¡Œ
   - ä½¿ç”¨å›è°ƒæ¥å£åœ¨UIçº¿ç¨‹æ›´æ–°ç•Œé¢

4. **æ€§èƒ½ä¼˜åŒ–**
   - ä½¿ç”¨ç´¢å¼•åŠ é€ŸæŸ¥è¯¢
   - æ‰¹é‡æ“ä½œä½¿ç”¨äº‹åŠ¡
   - é¿å…åœ¨ä¸»çº¿ç¨‹æŸ¥è¯¢

## ğŸ“ æ•°æ®å¯¼å…¥å¯¼å‡º

### ä»JSONå¯¼å…¥é¢˜ç›®

```java
// 1. å‡†å¤‡JSONæ ¼å¼çš„é¢˜ç›®æ•°æ®
String jsonData = "[{\"question\":\"...\",\"options\":[...],\"answer\":0}]";

// 2. è§£æå¹¶æ’å…¥
Gson gson = new Gson();
List<QuestionEntity> questions = gson.fromJson(jsonData, 
    new TypeToken<List<QuestionEntity>>(){}.getType());

repository.insertQuestions(questions, listener);
```

### å¯¼å‡ºé¢˜ç›®åˆ°JSON

```java
repository.getAllActiveQuestions(new QuestionRepository.OnDataLoadListener<List<QuestionEntity>>() {
    @Override
    public void onDataLoaded(List<QuestionEntity> data) {
        Gson gson = new Gson();
        String json = gson.toJson(data);
        // ä¿å­˜åˆ°æ–‡ä»¶æˆ–åˆ†äº«
    }
    
    @Override
    public void onError(String error) {
        // å¤„ç†é”™è¯¯
    }
});
```

## ğŸ†˜ å¸¸è§é—®é¢˜

**Q: ä¿®æ”¹ä»£ç åé¢˜ç›®æ²¡æœ‰æ›´æ–°ï¼Ÿ**
A: éœ€è¦å¢åŠ `CURRENT_DATA_VERSION`ç‰ˆæœ¬å·ï¼Œæˆ–å¸è½½é‡è£…åº”ç”¨ã€‚

**Q: å¦‚ä½•ä¸´æ—¶ç¦ç”¨æŸäº›é¢˜ç›®ï¼Ÿ**
A: è®¾ç½®`question.setActive(false)`ï¼Œé¢˜ç›®ä¸ä¼šè¢«æŸ¥è¯¢åˆ°ã€‚

**Q: å¦‚ä½•é‡ç½®æ‰€æœ‰é¢˜ç›®çš„ç»Ÿè®¡æ•°æ®ï¼Ÿ**
A: ä½¿ç”¨QuestionDaoçš„`recalculateAllAccuracyRates()`æ–¹æ³•ã€‚

**Q: æ•°æ®åº“å¤ªå¤§æ€ä¹ˆåŠï¼Ÿ**
A: åˆ é™¤ä¸æ´»è·ƒçš„é¢˜ç›®ï¼š`questionDao.deleteInactiveQuestions()`ã€‚

## ğŸ“§ æŠ€æœ¯æ”¯æŒ

å¦‚æœ‰é—®é¢˜ï¼Œè¯·æŸ¥çœ‹ï¼š
- `QuestionRepository.java` - æ•°æ®æ“ä½œæ¥å£
- `QuestionDao.java` - æ•°æ®åº“æŸ¥è¯¢æ–¹æ³•
- `QuestionEntity.java` - é¢˜ç›®æ•°æ®æ¨¡å‹
- `QuestionDataInitializer.java` - æ•°æ®åˆå§‹åŒ–å·¥å…·

