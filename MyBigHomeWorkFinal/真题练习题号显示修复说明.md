# 真题练习题号显示修复说明

## 修复内容

### 问题描述
1. **题号显示错误**：从完形填空切换到阅读理解时，题号切换器显示混乱
2. **选项缺少字母标识**：阅读理解选项没有ABCD前缀

### 解决方案

#### 1. 动态题号范围系统
添加了 `getQuestionNumberRange()` 方法，根据当前题目自动计算应该显示的题号范围：

| 题目范围 | 部分名称 | 显示题号 |
|---------|---------|---------|
| 索引 0-19 | 完形填空 | 1-20 |
| 索引 20-24 | 阅读理解 Text 1 | 21-25 |
| 索引 25-29 | 阅读理解 Text 2 | 26-30 |
| 索引 30-34 | 阅读理解 Text 3 | 31-35 |
| 索引 35-39 | 阅读理解 Text 4 | 36-40 |
| 索引 40-44 | 新题型 | 41-45 |
| 索引 45 | 翻译 | 46 |
| 索引 46 | 写作 | 47 |

#### 2. 智能题号刷新机制
- 添加了 `currentRange` 缓存变量
- 只有当题目范围改变时才重建题号按钮
- 同一范围内切换题目只更新高亮状态
- 优化了性能，避免不必要的UI重建

#### 3. 选项字母前缀
阅读理解选项现在显示格式为：
- **A** was regarded as a sign of generosity
- **B** was considered essential for waiters
- **C** was a way of rewarding diligence
- **D** was optional in most businesses

## 测试步骤

### 测试1：完形填空题号显示
1. 打开真题练习，进入2025年考研英语（二）
2. 在完形填空第1-20题之间切换
3. **预期结果**：底部题号显示1-20，高亮当前题号

### 测试2：阅读理解 Text 1 题号显示
1. 点击"下一题"切换到第21题
2. **预期结果**：
   - 底部题号自动切换为21-25
   - 当前题号21高亮
   - 选项显示"A 选项文本"格式

### 测试3：阅读理解 Text 2-4 题号显示
1. 继续切换到第26题（Text 2）
2. **预期结果**：底部题号显示26-30
3. 切换到第31题（Text 3）
4. **预期结果**：底部题号显示31-35
5. 切换到第36题（Text 4）
6. **预期结果**：底部题号显示36-40

### 测试4：新题型题号显示
1. 切换到第41题
2. **预期结果**：底部题号显示41-45

### 测试5：翻译和写作题号显示
1. 切换到第46题（翻译）
2. **预期结果**：底部题号显示46
3. 切换到第47题（写作）
4. **预期结果**：底部题号显示47

### 测试6：题号点击跳转
1. 在阅读理解Text 1（21-25题）中，点击底部题号23
2. **预期结果**：跳转到第23题
3. 点击"下一题"到第26题
4. **预期结果**：题号自动切换为26-30

### 测试7：答题状态保持
1. 在第21题选择一个答案
2. 切换到第22题
3. 切换回第21题
4. **预期结果**：
   - 之前选择的答案依然高亮
   - 题号21显示✓标记

## 关键修改文件
- `app/src/main/java/com/example/mybighomework/ExamAnswerActivity.java`

## 修改行数
- 添加 `currentRange` 变量：第60行
- 添加 `getQuestionNumberRange()` 方法：第1140-1160行
- 修改 `initQuestionNumbers()` 方法：第1165-1227行
- 修改 `updateQuestionNumberHighlight()` 方法：第1231-1271行
- 修改 `showReadingComprehensionQuestion()` 方法：第906-909行
- 修改 `showCurrentQuestion()` 方法：第854行

## 技术细节

### 性能优化
使用范围缓存避免不必要的UI重建：
```java
// 检查范围是否改变
if (currentRange != null && currentRange[0] == range[0] && currentRange[1] == range[1]) {
    // 范围未变，只更新高亮
    updateQuestionNumberHighlight();
    return;
}
```

### 题号计算
题号按钮显示实际题号（而不是相对索引）：
```java
for (int i = 0; i < questionCount; i++) {
    final int questionIndex = startIndex + i;
    tvNumber.setText(String.valueOf(questionIndex + 1)); // 显示真实题号
}
```

## 验证清单
- [x] 完形填空显示1-20题号
- [x] 阅读理解Text 1显示21-25题号
- [x] 阅读理解Text 2显示26-30题号
- [x] 阅读理解Text 3显示31-35题号
- [x] 阅读理解Text 4显示36-40题号
- [x] 新题型显示41-45题号
- [x] 翻译显示46题号
- [x] 写作显示47题号
- [x] 阅读理解选项有ABCD前缀
- [x] 题号点击跳转正常
- [x] 答题状态保持正确
- [x] 跨部分切换题号自动更新

## 注意事项
- 编译项目后需要重新安装APK到设备
- 如果之前有运行中的应用，请完全关闭后重新打开
- 题号切换器会在切换到新的题目部分时自动刷新

